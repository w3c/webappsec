<!doctype html>
<html lang="en">
 <head>
  
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  
  
  <title>Credential Management Level 1</title>
  
  
  <link href="default.css" rel="stylesheet" type="text/css">
  
  
  <link href="https://www.w3.org/StyleSheets/TR/W3C-WD" rel="stylesheet" type="text/css">
  

  <meta content="Bikeshed 1.0.0" name="generator">
 </head>
 

 <body class="h-entry">

  <div class="head">
  
   <p data-fill-with="logo"><a class="logo" href="http://www.w3.org/">
    <img alt="W3C" height="48" src="https://www.w3.org/Icons/w3c_home" width="72">
</a>
</p>
  
   <h1 class="p-name no-ref" id="title">Credential Management Level 1</h1>
  
   <h2 class="no-num no-toc no-ref heading settled" id="subtitle"><span class="content">W3C First Public Working Draft,
    <time class="dt-updated" datetime="2015-04-30">30 April 2015</time></span></h2>
  
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="http://www.w3.org/TR/2015/WD-credential-management-1-20150430/">http://www.w3.org/TR/2015/WD-credential-management-1-20150430/</a>
     <dt>Latest version:
     <dd><a href="http://www.w3.org/TR/credential-management/">http://www.w3.org/TR/credential-management/</a>
     <dt>Editor's Draft:
     <dd><a href="https://w3c.github.io/webappsec/specs/credentialmanagement/">https://w3c.github.io/webappsec/specs/credentialmanagement/</a>
     <dt>Version History:
     <dd><a href="https://github.com/w3c/webappsec/commits/master/specs/credentialmanagement/index.src.html">https://github.com/w3c/webappsec/commits/master/specs/credentialmanagement/index.src.html</a>
     <dt>Feedback:
     <dd><span><a href="mailto:public-webappsec@w3.org?subject=%5Bcredential-management%5D%20feedback">public-webappsec@w3.org</a> with subject line “<kbd>[credential-management] <var>… message topic …</var></kbd>” (<a href="http://lists.w3.org/Archives/Public/public-webappsec/" rel="discussion">archives</a>)</span>
     <dt>Issue Tracking:
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editor:
     <dd class="editor p-author h-card vcard" data-editor-id="56384"><a class="p-name fn u-email email" href="mailto:mkwst@google.com">Mike West</a> (<span class="p-org org">Google Inc.</span>)
     <dt>Use Cases:
     <dd><span><a href="https://w3c.github.io/webappsec/usecases/credentialmanagement/">https://w3c.github.io/webappsec/usecases/credentialmanagement/</a></span>
     <dt>Bug Reports:
     <dd><span><a href="https://github.com/w3c/webappsec/issues/new?title=CREDENTIAL:%20">via the w3c/webappsec repository on GitHub</a></span>
    </dl>
   </div>
  
   <div data-fill-with="warning"></div>
  
   <p class="copyright" data-fill-with="copyright"><a href="http://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a> © 2015 <a href="http://www.w3.org/"><abbr title="World Wide Web Consortium">W3C</abbr></a><sup>®</sup> (<a href="http://www.csail.mit.edu/"><abbr title="Massachusetts Institute of Technology">MIT</abbr></a>, <a href="http://www.ercim.eu/"><abbr title="European Research Consortium for Informatics and Mathematics">ERCIM</abbr></a>, <a href="http://www.keio.ac.jp/">Keio</a>, <a href="http://ev.buaa.edu.cn/">Beihang</a>). W3C <a href="http://www.w3.org/Consortium/Legal/ipr-notice#Legal_Disclaimer">liability</a>, <a href="http://www.w3.org/Consortium/Legal/ipr-notice#W3C_Trademarks">trademark</a> and <a href="http://www.w3.org/Consortium/Legal/copyright-documents">document use</a> rules apply.
</p>
  
   <hr title="Separator for header">
</div>


  <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>

  <div class="p-summary" data-fill-with="abstract">
   <p>This specification describes an imperative API enabling a website to request a

user’s credentials from a user agent, and to help the user agent correctly
store user credentials for future use.</p>

</div>


  <h2 class="no-num no-toc no-ref heading settled" id="status"><span class="content">Status of this document</span></h2>

  <div data-fill-with="status">
   <p>
  <em>This section describes the status of this document at the time of
  its publication. Other documents may supersede this document. A list of
  current W3C publications and the latest revision of this technical report
  can be found in the <a href="http://www.w3.org/TR/">W3C technical reports
  index at http://www.w3.org/TR/.</a></em>

</p>
   <p>
  This document was published by the
  <a href="http://www.w3.org/2011/webappsec/">Web Application Security Working Group</a>
  as a Working Draft. This document is intended to become a W3C Recommendation.

</p>
   <p>
	The (<a href="http://lists.w3.org/Archives/Public/public-webappsec/">archived</a>) public mailing list
	<a href="mailto:public-webappsec@w3.org?Subject=%5Bcredential-management%5D%20PUT%20SUBJECT%20HERE">public-webappsec@w3.org</a>
	(see <a href="http://www.w3.org/Mail/Request">instructions</a>)
	is preferred for discussion of this specification.
	When sending e-mail,
	please put the text “credential-management” in the subject,
	preferably like this:
	“[credential-management] <em>…summary of comment…</em>”

</p>
   <p>
  This document is a <strong>First Public Working Draft</strong>.

</p>
   <p>
  Publication as a First Public Working Draft does not imply endorsement by the W3C
  Membership. This is a draft document and may be updated, replaced or
  obsoleted by other documents at any time. It is inappropriate to cite this
  document as other than work in progress.

</p>
   <p>
	This document was produced by the
  <a href="http://www.w3.org/2011/webappsec/">Web Application Security Working Group</a>.

</p>
   <p>
	This document was produced by a group operating under
	the <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/">5 February 2004 W3C Patent Policy</a>.
	W3C maintains a <a href="http://www.w3.org/2004/01/pp-impl/49309/status" rel="disclosure">public list of any patent disclosures</a>
	made in connection with the deliverables of the group;
	that page also includes instructions for disclosing a patent.
	An individual who has actual knowledge of a patent which the individual believes contains <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#def-essential">Essential Claim(s)</a>
	must disclose the information in accordance with <a href="http://www.w3.org/Consortium/Patent-Policy-20040205/#sec-Disclosure">section 6 of the W3C Patent Policy</a>.

</p>
   <p>
  This document is governed by the <a href="http://www.w3.org/2014/Process-20140801/" id="w3c_process_revision">1 August 2014 W3C Process Document</a>.
</p></div>

  <div data-fill-with="at-risk"></div>


  <h2 class="no-num no-toc no-ref heading settled" id="contents"><span class="content">Table of Contents</span></h2>

  <div data-fill-with="table-of-contents" role="navigation">
   <ul class="toc" role="directory">
    <li><a href="#introduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
     <ul class="toc">
      <li><a href="#use-cases"><span class="secno">1.1</span> <span class="content">Use Cases</span></a>
      <li><a href="#introduction-examples"><span class="secno">1.2</span> <span class="content">Examples</span></a>
       <ul class="toc">
        <li><a href="#examples-password-signin"><span class="secno">1.2.1</span> <span class="content">Password-based Sign-in</span></a>
        <li><a href="#examples-federated-signin"><span class="secno">1.2.2</span> <span class="content">Federated Sign-in</span></a>
        <li><a href="#examples-post-signin"><span class="secno">1.2.3</span> <span class="content">Post-sign-in Confirmation</span></a>
        <li><a href="#examples-sign-up"><span class="secno">1.2.4</span> <span class="content">Sign-Up</span></a>
        <li><a href="#examples-change-password"><span class="secno">1.2.5</span> <span class="content">Change Password</span></a>
       </ul>
      <li><a href="#existing-solutions"><span class="secno">1.3</span> <span class="content">
      Haven’t we done this before? What about [<em>insert technology here</em>]?
    </span></a>
       <ul class="toc">
        <li><a href="#existing-solutions-browserid"><span class="secno">1.3.1</span> <span class="content">BrowserID/Persona</span></a>
        <li><a href="#existing-solutions-webid"><span class="secno">1.3.2</span> <span class="content">WebID</span></a>
       </ul>
     </ul>
    <li><a href="#terms"><span class="secno">2</span> <span class="content">Key Concepts and Terminology</span></a>
    <li><a href="#interfaces"><span class="secno">3</span> <span class="content">Interfaces</span></a>
     <ul class="toc">
      <li><a href="#interfaces-credential-types"><span class="secno">3.1</span> <span class="content">Credential Types</span></a>
       <ul class="toc">
        <li><a href="#interfaces-credential-types-credential"><span class="secno">3.1.1</span> <span class="content"><code>Credential</code></span></a>
        <li><a href="#interfaces-credential-types-passwordcredential"><span class="secno">3.1.2</span> <span class="content"><code>PasswordCredential</code></span></a>
         <ul class="toc">
          <li><a href="#passwordcredential-matching"><span class="secno">3.1.2.1</span> <span class="content">
    Matching Algorithm
  </span></a>
         </ul>
        <li><a href="#interfaces-credential-types-federatedcredential"><span class="secno">3.1.3</span> <span class="content"><code>FederatedCredential</code></span></a>
         <ul class="toc">
          <li><a href="#federatedcredential-matching"><span class="secno">3.1.3.1</span> <span class="content">
    Matching Algorithm
  </span></a>
         </ul>
       </ul>
      <li><a href="#interfaces-credential-manager"><span class="secno">3.2</span> <span class="content">Credential Manager</span></a>
       <ul class="toc">
        <li><a href="#interfaces-request-options"><span class="secno">3.2.1</span> <span class="content">
    <code>get()</code> Parameters
  </span></a>
        <li><a href="#identifying-federations"><span class="secno">3.2.2</span> <span class="content">Identifying providers</span></a>
       </ul>
     </ul>
    <li><a href="#algorithms"><span class="secno">4</span> <span class="content">Algorithms</span></a>
     <ul class="toc">
      <li><a href="#processing"><span class="secno">4.1</span> <span class="content">
    Processing <code>Credential</code>s
  </span></a>
       <ul class="toc">
        <li><a href="#request-credential"><span class="secno">4.1.1</span> <span class="content">
    Request a <code>Credential</code>
  </span></a>
        <li><a href="#store-credential"><span class="secno">4.1.2</span> <span class="content">
    Store a <code>Credential</code>
  </span></a>
       </ul>
      <li><a href="#processing-locallystored"><span class="secno">4.2</span> <span class="content">
    Processing <code>LocallyStoredCredential</code>s
  </span></a>
       <ul class="toc">
        <li><a href="#gather-locallystoredcredentials"><span class="secno">4.2.1</span> <span class="content">
    Gather <code>LocallyStoredCredential</code>s
  </span></a>
        <li><a href="#request-locallystoredcredential-without-mediation"><span class="secno">4.2.2</span> <span class="content">
    Request a <code>LocallyStoredCredential</code> <em>without</em> user mediation
  </span></a>
        <li><a href="#request-locallystoredcredential-with-mediation"><span class="secno">4.2.3</span> <span class="content">
    Request a <code>LocallyStoredCredential</code> with user mediation
  </span></a>
        <li><a href="#send-passwordcredential"><span class="secno">4.2.4</span> <span class="content">
    Send <var>passwordCredential</var> to <var>url</var>.
  </span></a>
        <li><a href="#store-locallystoredcredential"><span class="secno">4.2.5</span> <span class="content">
    Store <code>LocallyStoredCredential</code>
  </span></a>
        <li><a href="#require-user-mediation-for-origin"><span class="secno">4.2.6</span> <span class="content">
    Require user mediation for <var>origin</var>
  </span></a>
        <li><a href="#is-match"><span class="secno">4.2.7</span> <span class="content">
    Does <var>credential</var> match <var>origin B</var>?
  </span></a>
       </ul>
     </ul>
    <li><a href="#user-mediation"><span class="secno">5</span> <span class="content">User Mediation</span></a>
     <ul class="toc">
      <li><a href="#user-mediated-storage"><span class="secno">5.1</span> <span class="content">Storing and Updating Credentials</span></a>
      <li><a href="#user-mediation-requirements"><span class="secno">5.2</span> <span class="content">Requiring User Mediation</span></a>
      <li><a href="#user-mediated-selection"><span class="secno">5.3</span> <span class="content">Credential Selection</span></a>
       <ul class="toc">
        <li><a href="#synthesis"><span class="secno">5.3.1</span> <span class="content">Synthesizing Credentials</span></a>
       </ul>
     </ul>
    <li><a href="#security-considerations"><span class="secno">6</span> <span class="content">Security Considerations</span></a>
     <ul class="toc">
      <li><a href="#security-cross-origin-leakage"><span class="secno">6.1</span> <span class="content">Cross-origin Credential Leakage</span></a>
      <li><a href="#security-origin-confusion"><span class="secno">6.2</span> <span class="content">Origin Confusion</span></a>
      <li><a href="#security-insecure-origins"><span class="secno">6.3</span> <span class="content">Insecure Sites</span></a>
      <li><a href="#security-xss"><span class="secno">6.4</span> <span class="content">Script Injection</span></a>
      <li><a href="#security-autocomplete-off"><span class="secno">6.5</span> <span class="content">
    Avoid reintroducing <code>autocomplete="off"</code>
  </span></a>
     </ul>
    <li><a href="#privacy-considerations"><span class="secno">7</span> <span class="content">Privacy Considerations</span></a>
     <ul class="toc">
      <li><a href="#privacy-timing-attacks"><span class="secno">7.1</span> <span class="content">Timing Attacks</span></a>
      <li><a href="#privacy-chooser-leakage"><span class="secno">7.2</span> <span class="content">Chooser Leakage</span></a>
      <li><a href="#locally-stored-data"><span class="secno">7.3</span> <span class="content">Locally Stored Data</span></a>
     </ul>
    <li><a href="#implementation-considerations"><span class="secno">8</span> <span class="content">Implementation Considerations</span></a>
     <ul class="toc">
      <li><a href="#implementation-for-authors"><span class="secno">8.1</span> <span class="content">Website Authors</span></a>
      <li><a href="#implementation-extension"><span class="secno">8.2</span> <span class="content">Extension Points</span></a>
      <li><a href="#implementation-browser-extensions"><span class="secno">8.3</span> <span class="content">Browser Extensions</span></a>
     </ul>
    <li><a href="#future-work"><span class="secno">9</span> <span class="content">Future Work</span></a>
    <li><a href="#conformance"><span class="secno"></span> <span class="content">Conformance</span></a>
     <ul class="toc">
      <li><a href="#conventions"><span class="secno"></span> <span class="content">Document conventions</span></a>
      <li><a href="#conformant-algorithms"><span class="secno"></span> <span class="content">Conformant Algorithms</span></a>
      <li><a href="#conformance-classes"><span class="secno"></span> <span class="content">Conformance Classes</span></a>
     </ul>
    <li><a href="#index"><span class="secno"></span> <span class="content">Index</span></a>
     <ul class="toc">
      <li><a href="#index-defined-here"><span class="secno"></span> <span class="content">Terms defined by this specification</span></a>
      <li><a href="#index-defined-elsewhere"><span class="secno"></span> <span class="content">Terms defined by reference</span></a>
     </ul>
    <li><a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ul class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ul>
    <li><a href="#idl-index"><span class="secno"></span> <span class="content">IDL Index</span></a>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ul></div>

  <main>







   <section>
  
    <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#introduction"></a></h2>


    <p><em>This section is not normative.</em></p>


    <p>Signing into websites is more difficult than it should be. The user agent is
  in a unique position to improve the experience in a number of ways, and most
  modern user agents have recognized this by providing some measure of
  credential management natively in the browser. Users can save usernames and
  passwords for websites, and those <a data-link-type="dfn" href="#credentials">credentials</a> are autofilled into
  sign-in forms with varying degrees of success.</p>


    <p>The <code><a data-link-type="element-attr" href="http://www.w3.org/TR/html5/forms.html#attr-form-autocomplete">autocomplete</a></code> attribute offers a
  declarative mechanism by which websites can work with user agents to improve
  the latter’s ability to detect and fill sign-in forms by marking specific
  fields as "username" or "password", and user agents implement a wide variety
  of detection heuristics to work with websites which haven’t taken the time to
  provide this detail in markup.</p>


    <p>While this combination of heuristic and declarative detection works relatively
  well, the status quo leaves some large gaps where detection is problematic.
  Sites with uncommon sign-in mechanisms (submitting credentials via
  <code class="idl"><a data-link-type="idl" href="https://xhr.spec.whatwg.org/#interface-xmlhttprequest">XMLHttpRequest</a></code> <a data-link-type="biblio" href="#biblio-xmlhttprequest">[XMLHTTPREQUEST]</a>, for instance) are difficult to reliably
  detect, as is the increasingly common case in which users wish to authenticate
  themselves using a <a data-link-type="dfn" href="#federated-identity-provider">federated identity provider</a>. Allowing websites to
  more directly interact with the user agent’s credential manager would allow
  the credential manager to be more accurate on the one hand, and to assist
  users with federated sign-in on the other.</p>


    <p>These use cases are explored in more detail in <a href="#use-cases">§1.1 Use Cases</a> and in
  <a href="https://w3c.github.io/webappsec/usecases/credentialmanagement/">
  Credential Management: Use Cases and Requirements</a>; this specification
  attempts to address many of the requirements that document outlines by
  defining a Credential Manager API which a website can use to request
  <a data-link-type="dfn" href="#credentials">credentials</a> for a user, and to ask the user agent to persist
  credentials when a user signs in successfully.</p>


    <p class="note" role="note">Note: The API defined here is intentionally small and simple: it does not
  intend to provide authentication in and of itself, but is limited to providing
  an interface to the existing credential managers implemented by existing user
  agents. That functionality is valuable <em>right now</em>, without significant
  effort on the part of either vendors or authors. There’s certainly quite a bit
  more which could be done, of course. See <a href="#future-work">§9 Future Work</a> for some thoughts
  we’ve punted for now, but which could be explored in future iterations of this
  API.</p>

  
    <section>
    
     <h3 class="heading settled" data-level="1.1" id="use-cases"><span class="secno">1.1. </span><span class="content">Use Cases</span><a class="self-link" href="#use-cases"></a></h3>
     


     <p>Modern user agents generally offer users the capability to save passwords
    when signing into a website, and likewise offer the capability to fill those
    passwords into sign-in forms fully- or semi-automatically when users return
    to a website. From the perspective of a website, this behavior is completely
    invisible: the website doesn’t know that passwords have been stored, and it
    isn’t notified that passwords have been filled. This is both good and bad.
    On the one hand, a user agent’s password manager works regardless of whether
    or not a site cooperates, which is excellent for users. On the other, the
    password managers' behaviors are a fragile and proprietary hodgepodge of
    heuristics meant to detect and fill sign-in forms, password change forms,
    etc.</p>
     


     <p>A few problems with the status quo stand out as being particularly
    problematic:</p>
     

    
     <ul>
      
      <li>
        User agents have an incredibly difficult time helping users with
        federated identity providers. While detecting a username/password
        form submission is fairly straightforward, detecting sign-in via a
        third-party is quite difficult to reliably do well. It would be nice
        if a website could help the user agent understand the intent behind the
        redirects associated with a typical federated sign-in action.
      
      
      
      <li>
        Likewise, user agents struggle to detect more esoteric sign-in
        mechanisms than simple username/password forms. Authors increasingly
        asynchronously sign users in via <code class="idl"><a data-link-type="idl" href="https://xhr.spec.whatwg.org/#interface-xmlhttprequest">XMLHttpRequest</a></code> or similar
        mechanisms in order to improve the experience and take more control over
        the presentation. This is good for users, but tough for user agents to
        integrate into their password managers. It would be nice if a website
        could help the user agent make sense of the sign-in mechanism they
        choose to use.
      
      
      
      <li>
        While signing into a website with a username and password is fairly well
        supported, creating a new account on a website is more or less left up
        to the user. The user agent’s knowledge of a user’s browsing history,
        access to the <a data-link-type="dfn" href="#credential-store">credential store</a>, and general mediation of a user’s
        activity means that it is in a very good position indeed to help users
        sign up for new sites.


       <p class="note" role="note">Note: This is especially true for sites which support federated identity
        providers, as those often support not just one or two, but many. Rather
        than presenting a user with a dozen icons from which to choose a
        familiar-looking provider, the site can ask the user agent to display
        only those providers the user actually uses. See
        <a href="#user-mediated-selection">§5.3 Credential Selection</a> for discussion.</p>
       
      
      
      
      <li>
        Finally, changing passwords is less well-suppported than it could be if
        the website explicitly informed the user agent that credentials had
        changed.
      
      
    
     </ul>
     
  
    </section>

  
    <section>
    
     <h3 class="heading settled" data-level="1.2" id="introduction-examples"><span class="secno">1.2. </span><span class="content">Examples</span><a class="self-link" href="#introduction-examples"></a></h3>
     

    
     <h4 class="heading settled" data-level="1.2.1" id="examples-password-signin"><span class="secno">1.2.1. </span><span class="content">Password-based Sign-in</span><a class="self-link" href="#examples-password-signin"></a></h4>
     


     <p>A website that supports only username/password pairs can request
    credentials, and use them in existing sign-in forms:</p>
     

    
     <div class="example" id="example-2b9eba1f"><a class="self-link" href="#example-2b9eba1f"></a>
      
      <pre>navigator.<a class="idl-code" data-link-type="attribute" href="#dom-navigator-credentials">credentials</a>.<a data-link-type="idl" href="#dom-credentialcontainer-getrequest">get</a>({
  "<a data-link-type="idl" href="#dom-credentialrequest-types">types</a>": [ "password" ]
}).then(
    function(credential) {
      if (!credential) {
        // The user either doesn’t have credentials for this site, or
        // refused to share them. Insert some code here to show a basic
        // login form (or, ideally, do nothing, since this API should
        // really be progressive enhancement on top of an existing form).
        return;
      }
      if (credential.type == "PasswordCredential") {
        credential.<a class="idl-code" data-link-type="method" href="#dom-passwordcredential-sendurl">send</a>("https://example.com/loginEndpoint")
          .then(function (response) {
            // Notify the user that signin succeeded! Do amazing, signed-in things!
          });
      } else {
        // See <a href="#examples-federated-signin">the Federated Sign-in example</a>
      }
    });
</pre>
      
    
     </div>
     

    
     <h4 class="heading settled" data-level="1.2.2" id="examples-federated-signin"><span class="secno">1.2.2. </span><span class="content">Federated Sign-in</span><a class="self-link" href="#examples-federated-signin"></a></h4>
     


     <p>A website that supports <a data-link-type="dfn" href="#federated-identity-provider">federated identity providers</a> can request
    credentials, and use them to kick off the sign-in flow for the user’s
    chosen provider:</p>
     

    
     <div class="example" id="example-0f1190a9"><a class="self-link" href="#example-0f1190a9"></a>
      
      <pre>navigator.<a class="idl-code" data-link-type="attribute" href="#dom-navigator-credentials">credentials</a>.<a data-link-type="idl" href="#dom-credentialcontainer-getrequest">get</a>({
  "<a data-link-type="idl" href="#dom-credentialrequest-types">types</a>": [ "federated" ],
  "<a data-link-type="idl" href="#dom-credentialrequest-options">options</a>": {
      "<a data-link-type="idl" href="#dom-federatedcredentialrequestoptions-providers">providers</a>": [ "https://federation.com" ]
  }
}).then(
    function(credential) {
      if (!credential)
        return;

      if (credential.type == "FederatedCredential") {
        switch (credential.<a data-link-type="idl" href="#dom-federatedcredential-provider">provider</a>) {
        case "https://www.facebook.com/":
          // Use Facebook’s SDK, a la https://developers.facebook.com/docs/facebook-login/login-flow-for-web/#logindialog
          FB.login(function (response) {
            if (response.status === "authorized") {
              // Can now use FB.api() calls
            } else {
              // Explain to the user that we would really like them to click "Log me in"
            }
          });
          break;

        case "https://accounts.google.com/":
          // Ditto
          break;

        // ...
        }
      } else {
        credential.<a class="idl-code" data-link-type="method" href="#dom-passwordcredential-sendurl">send</a>("https://example.com/loginEndpoint")
          .then(function (response) { ... })
          .catch(function (response) { ... });
      }
    });
</pre>
      


      <p class="note" role="note">Note: This API does not go out to the identity provider to grab a token,
      or authenticate the user in any way. It provides a hint to the website as
      to which identity provider the user prefers to use, and little more. See
      <a href="#future-work">§9 Future Work</a> for directions future versions of this API could take.</p>
      
    
     </div>
     

    
     <h4 class="heading settled" data-level="1.2.3" id="examples-post-signin"><span class="secno">1.2.3. </span><span class="content">Post-sign-in Confirmation</span><a class="self-link" href="#examples-post-signin"></a></h4>
     


     <p>To ensure that credentials are persisted correctly, it may be useful for a
    website to tell the credential manager that sign-in succeeded.</p>
     

    
     <div class="example" id="example-2581549a"><a class="self-link" href="#example-2581549a"></a>
      If a user is signed in by calling <code class="idl"><a data-link-type="idl" href="#dom-passwordcredential-sendurl">send()</a></code> on a <code class="idl"><a data-link-type="idl" href="#passwordcredential">PasswordCredential</a></code>
      object, then we can check the response to determine whether the user
      was signed in successfully, and notify the user agent accordingly:

      
      <pre>var credential = new <a data-link-type="idl" href="#passwordcredential">PasswordCredential</a>({
  "<a data-link-type="idl" href="#dom-credentialdata-id">id</a>": "JaneDoe98",
  "<a data-link-type="idl" href="#dom-passwordcredentialdata-password">password</a>": "MfPeRQq5P3yVry68Q4KZMMhB"
});
credential.send("https://example.com/sign-in/")
  .then(function (response) {
    if (response.status == 200)
      navigator.<a class="idl-code" data-link-type="attribute" href="#dom-navigator-credentials">credentials</a>.<a data-link-type="idl" href="#dom-credentialcontainer-storecredential">store</a>(credential);
  });
</pre>
      


      <p class="note" role="note">Note: This example assumes that the sign-in API endpoint will
      differentiate between success and failure via an HTTP response code. This
      is a reasonable model, but it would of course also be possible to parse
      the response body for a <code>success</code> property, or some other form
      of application-specific signal.</p>
      
    
     </div>
     

    
     <div class="example" id="example-26d710d2"><a class="self-link" href="#example-26d710d2"></a>
      If we’re using a <a data-link-type="dfn" href="#federated-identity-provider">federated identity provider</a>:

      
      <pre>if (navigator.<a class="idl-code" data-link-type="attribute" href="#dom-navigator-credentials">credentials</a>) {
  navigator.<a class="idl-code" data-link-type="attribute" href="#dom-navigator-credentials">credentials</a>.<a data-link-type="idl" href="#dom-credentialcontainer-storecredential">store</a>(
    new <a data-link-type="idl" href="#federatedcredential">FederatedCredential</a>({
      "<a data-link-type="idl" href="#dom-credentialdata-id">id</a>": "username",
      "<a data-link-type="idl" href="#dom-federatedcredentialdata-provider">provider</a>": "https://federation.com"
    })
  );
}
</pre>
      
    
     </div>
     

    
     <h4 class="heading settled" data-level="1.2.4" id="examples-sign-up"><span class="secno">1.2.4. </span><span class="content">Sign-Up</span><a class="self-link" href="#examples-sign-up"></a></h4>
     


     <p>The "federated sign-in" mechanism can be reused for "sign-up" with no
    modifications: if the user has a credential from a supported federated
    identity provider, it could be offered to the user via the same request
    mechanism.</p>
     

    
     <h4 class="heading settled" data-level="1.2.5" id="examples-change-password"><span class="secno">1.2.5. </span><span class="content">Change Password</span><a class="self-link" href="#examples-change-password"></a></h4>
     


     <p>The "Password Sign-In" mechanism can be reused for "password change" with no
    modifications: if the user changes her credentials, the website can notify
    the user agent that she’s successfully signed in with new credentials. The
    user agent can then update the credentials it stores.</p>
     
  
    </section>

  
    <section>
    
     <h3 class="heading settled" data-level="1.3" id="existing-solutions"><span class="secno">1.3. </span><span class="content">
      Haven’t we done this before? What about [<em>insert technology here</em>]?
    </span><a class="self-link" href="#existing-solutions"></a></h3>
     

    
     <h4 class="heading settled" data-level="1.3.1" id="existing-solutions-browserid"><span class="secno">1.3.1. </span><span class="content">BrowserID/Persona</span><a class="self-link" href="#existing-solutions-browserid"></a></h4>
     


     <p>BrowserID is a proposal for an API which allows websites to request an
    assertion of a user’s email address ownership. <a data-link-type="biblio" href="#biblio-browserid">[BROWSERID]</a></p>
     


     <p>The API specified here does not attempt to assert the user’s identity
    directly: it only provides a more direct interface to the user agent’s
    <a data-link-type="dfn" href="#credential-store">credential store</a>. Assertions about identity would still rely on
    <a data-link-type="dfn" href="#federated-identity-provider">federated identity provider</a>’s particular SDKs and workflows.</p>
     


     <p>BrowserID is complementary to this API, and could be tacked onto the
    <code class="idl"><a data-link-type="idl" href="#federatedcredential">FederatedCredential</a></code> flow at some point in the future. For example, a
    user who chooses a <code class="idl"><a data-link-type="idl" href="#federatedcredential">FederatedCredential</a></code> whose origin supports
    BrowserID could perform the authentication steps in the background by
    passing the user’s email address and public key to the relevant
    <a data-link-type="dfn" href="#federated-identity-provider">identity provider</a>, and adding a new property to the
    <code class="idl"><a data-link-type="idl" href="#federatedcredential">FederatedCredential</a></code> given back to the website which contains the
    signed certificate asserting the user’s identity.</p>
     


     <p>This document doesn’t specify any of that behavior, but is designed with
    it in mind: the immediate goal is to give websites more direct access to
    the user agent’s existing credential manager, as federations are completely
    unsupported at the moment. Generating assertions is an obvious next step.
    See <a href="#future-work">§9 Future Work</a> for other thoughts on the subject.</p>
     

    
     <h4 class="heading settled" data-level="1.3.2" id="existing-solutions-webid"><span class="secno">1.3.2. </span><span class="content">WebID</span><a class="self-link" href="#existing-solutions-webid"></a></h4>
     


     <p>TODO</p>
     
  
    </section>
</section>



   <section>
  
    <h2 class="heading settled" data-level="2" id="terms"><span class="secno">2. </span><span class="content">Key Concepts and Terminology</span><a class="self-link" href="#terms"></a></h2>

  
    <dl>
    
     <dt><dfn data-dfn-type="dfn" data-export="" id="credentials">Credentials<a class="self-link" href="#credentials"></a></dfn>
     
    
     <dt><dfn data-dfn-type="dfn" data-export="" id="password-credentials">Password Credentials<a class="self-link" href="#password-credentials"></a></dfn>
     
    
     <dt><dfn data-dfn-type="dfn" data-export="" id="federated-credentials">Federated Credentials<a class="self-link" href="#federated-credentials"></a></dfn>
     
    
     <dd>
      Broadly speaking, <strong>credential</strong> is an assertion about an
      entity which enables a trust decision. This specification defines two
      specific types of credentials which are useful for authentication:
      "password" credentials, which consist of a username/password
      pair, and "federated" credentials, which point out to a <a data-link-type="dfn" href="#federated-identity-provider">federated
      identity provider</a> which is trusted to correctly assert a user’s
      authentication.


      <p class="note" role="note">Note: These two types are, of course, not exhaustive. Future versions of
      this and other documents will likely define other types of credentials.</p>
      
    
     

    
     <dt>
      <dfn data-dfn-type="dfn" data-export="" id="credential-store">Credential Store<a class="self-link" href="#credential-store"></a></dfn>
    
     
    
     <dd>
      A <strong>credential store</strong> is an opaque storage mechanism which
      offers a user agent the ability to save, retrieve, and modify
      <code class="idl"><a data-link-type="idl" href="#locallystoredcredential">LocallyStoredCredential</a></code> objects; and to mark <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origins</a> with a
      <dfn data-dfn-type="dfn" data-noexport="" id="requires-user-mediation">requires user mediation<a class="self-link" href="#requires-user-mediation"></a></dfn> flag. The implementation is
      vendor-specific, and the interface provided is not exposed to the web.


      <p class="note" role="note">Note: The types of credentials defined in this document are stored locally
      in a user agent’s credential store, but future versions of this and other
      documents will likely define credential types which are external to the
      user agent.</p>
      
    
     

    
     <dt>
      <dfn data-dfn-type="dfn" data-export="" data-local-lt="IDP|identity provider" id="federated-identity-provider">
        Federated Identity Provider
      <a class="self-link" href="#federated-identity-provider"></a></dfn>
    
     
    
     <dd>
      A <strong>federated identity provider</strong> is an entity which a
      website trusts to correctly authenticate a user, and which provides an
      API for that purpose. OAuth2 <a data-link-type="biblio" href="#biblio-rfc6749">[RFC6749]</a> is an example of such an API,
      used by a number of providers.
    
     
  
    </dl>
</section>



   <section>
  
    <h2 class="heading settled" data-level="3" id="interfaces"><span class="secno">3. </span><span class="content">Interfaces</span><a class="self-link" href="#interfaces"></a></h2>

  
    <h3 class="heading settled" data-level="3.1" id="interfaces-credential-types"><span class="secno">3.1. </span><span class="content">Credential Types</span><a class="self-link" href="#interfaces-credential-types"></a></h3>


    <p>This document defines a generic and extensible <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> interface from
  which all <a data-link-type="dfn" href="#credentials">credentials</a> will inherit, and a slightly less-generic
  <code class="idl"><a data-link-type="idl" href="#locallystoredcredential">LocallyStoredCredential</a></code>, which defines the specific attributes shared
  by any <a data-link-type="dfn" href="#credentials">credential</a> persisted in user agent’s <a data-link-type="dfn" href="#credential-store">credential store</a>.</p>


    <p><code class="idl"><a data-link-type="idl" href="#passwordcredential">PasswordCredential</a></code> and <code class="idl"><a data-link-type="idl" href="#federatedcredential">FederatedCredential</a></code> both inherit from
  <code class="idl"><a data-link-type="idl" href="#locallystoredcredential">LocallyStoredCredential</a></code>, and, as you might expect, are the concrete types
  mapped to <a data-link-type="dfn" href="#password-credentials">password credentials</a> and <a data-link-type="dfn" href="#federated-credentials">federated credentials</a>,
  respectively.</p>

  
    <h4 class="heading settled" data-level="3.1.1" id="interfaces-credential-types-credential"><span class="secno">3.1.1. </span><span class="content"><code>Credential</code></span><a class="self-link" href="#interfaces-credential-types-credential"></a></h4>
  
    <pre class="idl">dictionary <dfn class="idl-code" data-dfn-type="dictionary" data-export="" data-global-name="" id="dictdef-credentialdata">CredentialData<a class="self-link" href="#dictdef-credentialdata"></a></dfn> {
  DOMString <dfn class="idl-code" data-dfn-for="CredentialData" data-dfn-type="dict-member" data-export="" data-global-name="CredentialData<dictionary>/id<dict-member>" data-type="DOMString " id="dom-credentialdata-id">id<a class="self-link" href="#dom-credentialdata-id"></a></dfn>;
  DOMString <dfn class="idl-code" data-dfn-for="CredentialData" data-dfn-type="dict-member" data-export="" data-global-name="CredentialData<dictionary>/name<dict-member>" data-type="DOMString " id="dom-credentialdata-name">name<a class="self-link" href="#dom-credentialdata-name"></a></dfn>;
  USVString <dfn class="idl-code" data-dfn-for="CredentialData" data-dfn-type="dict-member" data-export="" data-global-name="CredentialData<dictionary>/iconURL<dict-member>" data-type="USVString " id="dom-credentialdata-iconurl">iconURL<a class="self-link" href="#dom-credentialdata-iconurl"></a></dfn>;
};

[NoInterfaceObject]
interface <dfn class="idl-code" data-dfn-type="interface" data-export="" data-global-name="" id="credential">Credential<a class="self-link" href="#credential"></a></dfn> {
  readonly attribute DOMString <a class="idl-code" data-global-name="Credential<interface>/id<attribute>" data-link-type="attribute" data-readonly="" data-type="DOMString " href="#dom-credential-id">id</a>;
  readonly attribute DOMString <a class="idl-code" data-global-name="Credential<interface>/type<attribute>" data-link-type="attribute" data-readonly="" data-type="DOMString " href="#dom-credential-type">type</a>;
};
<a data-link-type="idl-name" href="#credential">Credential</a> implements <a data-link-type="idl-name" href="http://www.w3.org/TR/html5/infrastructure.html#transferable">Transferable</a>;
</pre>
  
    <dl>
    
     <dt><dfn class="idl-code" data-dfn-for="Credential" data-dfn-type="attribute" data-export="" id="dom-credential-id">id<a class="self-link" href="#dom-credential-id"></a></dfn>, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a>, readonly</span>
     
    
     <dd>
      The credential’s identifier. This might be a GUID, username, or email
      address, for instance.
    
     
    
     <dt><dfn class="idl-code" data-dfn-for="Credential" data-dfn-type="attribute" data-export="" id="dom-credential-type">type<a class="self-link" href="#dom-credential-type"></a></dfn>, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a>, readonly</span>
     
    
     <dd>
      The credential’s type. This attribute’s getter returns the value of the
      credential’s <code class="idl"><a data-link-type="idl" href="#dom-credential-type-slot">[[type]]</a></code> slot.


      <p class="note" role="note">Note: The <code class="idl"><a data-link-type="idl" href="#dom-credential-type-slot">[[type]]</a></code> slot’s value will be the same for all
      credentials implementing a particular interface. Currently,
      <code class="idl"><a data-link-type="idl" href="#passwordcredential">PasswordCredential</a></code> objects have a <code class="idl"><a data-link-type="idl" href="#dom-credential-type-slot">[[type]]</a></code> of
      <code>password</code>, and <code class="idl"><a data-link-type="idl" href="#federatedcredential">FederatedCredential</a></code> objects have a
      <code class="idl"><a data-link-type="idl" href="#dom-credential-type-slot">[[type]]</a></code> of <code>federated</code>.</p>
      
    
     
    
     <dt><dfn class="idl-code" data-dfn-for="Credential" data-dfn-type="attribute" data-export="" id="dom-credential-type-slot">[[type]]<a class="self-link" href="#dom-credential-type-slot"></a></dfn>
     
    
     <dd>
      All <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> objects have an internal slot named
      <code class="idl"><a data-link-type="idl" href="#dom-credential-type-slot">[[type]]</a></code>, which unsurprisingly contains a string representing
      the type of the credential. This property is exposed to the web via the
      <code class="idl"><a data-link-type="idl" href="#dom-credential-type">type</a></code> attribute.
    
     
  
    </dl>


    <p><code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> objects implement <code class="idl"><a data-link-type="idl" href="http://www.w3.org/TR/html5/infrastructure.html#transferable">Transferable</a></code>, and MUST support the
  the <a data-link-type="dfn" href="http://www.w3.org/TR/html5/infrastructure.html#structured-clone">structured clone</a> algorithm by defining a cloning mechanism.</p>


    <p class="issue" id="issue-43c3f08c"><a class="self-link" href="#issue-43c3f08c"></a>Define cloning algorithms. <a href="https://github.com/w3c/webappsec/issues/287">&lt;https://github.com/w3c/webappsec/issues/287></a></p>

  
    <pre class="idl">[NoInterfaceObject]
interface <dfn class="idl-code" data-dfn-type="interface" data-export="" data-global-name="" id="locallystoredcredential">LocallyStoredCredential<a class="self-link" href="#locallystoredcredential"></a></dfn> {
  readonly attribute DOMString <a class="idl-code" data-global-name="LocallyStoredCredential<interface>/name<attribute>" data-link-type="attribute" data-readonly="" data-type="DOMString " href="#dom-locallystoredcredential-name">name</a>;
  readonly attribute USVString <a class="idl-code" data-global-name="LocallyStoredCredential<interface>/iconURL<attribute>" data-link-type="attribute" data-readonly="" data-type="USVString " href="#dom-locallystoredcredential-iconurl">iconURL</a>;
};
<a data-link-type="idl-name" href="#locallystoredcredential">LocallyStoredCredential</a> implements <a data-link-type="idl-name" href="#credential">Credential</a>;
</pre>
  
    <dl>
    
     <dt><dfn class="idl-code" data-dfn-for="LocallyStoredCredential" data-dfn-type="attribute" data-export="" id="dom-locallystoredcredential-name">name<a class="self-link" href="#dom-locallystoredcredential-name"></a></dfn>, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a>, readonly</span>
     
    
     <dd>
      A name associated with the credential, intended as a human-understandable
      public name.
    
     

    
     <dt><dfn class="idl-code" data-dfn-for="LocallyStoredCredential" data-dfn-type="attribute" data-export="" id="dom-locallystoredcredential-iconurl">iconURL<a class="self-link" href="#dom-locallystoredcredential-iconurl"></a></dfn>, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString">USVString</a>, readonly</span>
     
    
     <dd>
      A URL pointing to an image for the credential. This URL MUST NOT be an
      <a data-link-type="dfn" href="https://w3c.github.io/webappsec/specs/mixedcontent/#a-priori-insecure-url"><i lang="la">a priori</i> insecure URL</a>.


      <p class="issue" id="issue-c874d302"><a class="self-link" href="#issue-c874d302"></a>Anne suggests that this might be better modeled
      as an <code>ImageBitmap</code> or <code>blob:</code>. We also need to
      figure out responsiveness. Perhaps <a data-link-type="biblio" href="#biblio-manifest">[MANIFEST]</a>'s format? <a href="https://github.com/w3c/webappsec/issues/247">&lt;https://github.com/w3c/webappsec/issues/247></a></p>
      
    
     
    
     <dt><dfn class="idl-code" data-dfn-for="LocallyStoredCredential" data-dfn-type="attribute" data-export="" id="dom-locallystoredcredential-origin-slot">[[origin]]<a class="self-link" href="#dom-locallystoredcredential-origin-slot"></a></dfn>
     
    
     <dd>
      All <code class="idl"><a data-link-type="idl" href="#locallystoredcredential">LocallyStoredCredential</a></code> objects have an internal slot named
      <code class="idl"><a data-link-type="idl" href="#dom-locallystoredcredential-origin-slot">[[origin]]</a></code>, which stores the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a> for which the
      credential was saved. This property is not directly exposed to the web.
    
     
  
    </dl>


    <p>All <code class="idl"><a data-link-type="idl" href="#locallystoredcredential">LocallyStoredCredential</a></code> objects MUST define an <dfn data-dfn-type="dfn" data-noexport="" id="options-matching-algorithm">options matching
  algorithm<a class="self-link" href="#options-matching-algorithm"></a></dfn> which returns <code>Match</code> if the object matches an
  <code class="idl"><a data-link-type="idl" href="#dom-credentialrequest-options">options</a></code> dictionary, and <code>Does Not Match</code>
  otherwise.</p>

  
    <h4 class="heading settled" data-level="3.1.2" id="interfaces-credential-types-passwordcredential"><span class="secno">3.1.2. </span><span class="content"><code>PasswordCredential</code></span><a class="self-link" href="#interfaces-credential-types-passwordcredential"></a></h4>
  
    <pre class="idl">dictionary <dfn class="idl-code" data-dfn-type="dictionary" data-export="" data-global-name="" id="dictdef-passwordcredentialdata">PasswordCredentialData<a class="self-link" href="#dictdef-passwordcredentialdata"></a></dfn> : <a data-link-type="idl-name" href="#dictdef-credentialdata">CredentialData</a> {
  DOMString <dfn class="idl-code" data-dfn-for="PasswordCredentialData" data-dfn-type="dict-member" data-export="" data-global-name="PasswordCredentialData<dictionary>/password<dict-member>" data-type="DOMString " id="dom-passwordcredentialdata-password">password<a class="self-link" href="#dom-passwordcredentialdata-password"></a></dfn>;
};

[<dfn class="idl-code" data-dfn-for="PasswordCredential" data-dfn-type="constructor" data-export="" data-global-name="PasswordCredential<interface>/PasswordCredential(data)<constructor>" data-lt="PasswordCredential(data)" id="dom-passwordcredential-passwordcredentialdata">Constructor<a class="self-link" href="#dom-passwordcredential-passwordcredentialdata"></a></dfn>(<a data-link-type="idl-name" href="#dictdef-passwordcredentialdata">PasswordCredentialData</a> <dfn class="idl-code" data-dfn-for="PasswordCredential/PasswordCredential(data)" data-dfn-type="argument" data-export="" data-global-name="PasswordCredential<interface>/PasswordCredential(data)<method>/data<argument>" id="dom-passwordcredential-passwordcredentialdata-data">data<a class="self-link" href="#dom-passwordcredential-passwordcredentialdata-data"></a></dfn>), Exposed=Window]
interface <dfn class="idl-code" data-dfn-type="interface" data-export="" data-global-name="" id="passwordcredential">PasswordCredential<a class="self-link" href="#passwordcredential"></a></dfn> {
  Promise&lt;<a data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#response">Response</a>> <a class="idl-code" data-global-name="PasswordCredential<interface>/send(url)<method>" data-link-type="method" href="#dom-passwordcredential-sendurl">send</a>(USVString <dfn class="idl-code" data-dfn-for="PasswordCredential/send(url)" data-dfn-type="argument" data-export="" data-global-name="PasswordCredential<interface>/send(url)<method>/url<argument>" id="dom-passwordcredential-sendurl-url">url<a class="self-link" href="#dom-passwordcredential-sendurl-url"></a></dfn>);
};
<a data-link-type="idl-name" href="#passwordcredential">PasswordCredential</a> implements <a data-link-type="idl-name" href="#locallystoredcredential">LocallyStoredCredential</a>;
</pre>
  
    <dl>
    
     <dt><dfn class="idl-code" data-dfn-for="PasswordCredential" data-dfn-type="method" data-export="" id="dom-passwordcredential-sendurl">send(url)<a class="self-link" href="#dom-passwordcredential-sendurl"></a></dfn>
     
    
     <dd>
      This method can be used to transmit the username and password information
      represented by this object to a same-origin endpoint in order to sign a
      user into a website. The user agent MUST execute the algorithm described
      in <a href="#send-passwordcredential">§4.2.4 
    Send passwordCredential to url.
  </a> when this method is executed.


      <p class="issue" id="issue-9c1ed270"><a class="self-link" href="#issue-9c1ed270"></a>We need the ability to add additional
      information to the request (CSRF tokens, etc). <a href="https://github.com/w3c/webappsec/issues/241">&lt;https://github.com/w3c/webappsec/issues/241></a></p>
      


      <p class="issue" id="issue-317aa5d1"><a class="self-link" href="#issue-317aa5d1"></a>Probably not something for v1, but an
      interesting option would be to provide a hash function here that the user
      agent would apply to the password before sending it over the wire. <a href="https://github.com/w3c/webappsec/issues/288">&lt;https://github.com/w3c/webappsec/issues/288></a></p>
      
    
     
    
     <dt><code class="idl"><a data-link-type="idl" href="#dom-credential-type-slot">[[type]]</a></code>
     
    
     <dd>
      All <code class="idl"><a data-link-type="idl" href="#passwordcredential">PasswordCredential</a></code> objects have their <code class="idl"><a data-link-type="idl" href="#dom-credential-type-slot">[[type]]</a></code> slot’s
      value set to <code>password</code>.
    
     
  
    </dl>


    <p>All <code class="idl"><a data-link-type="idl" href="#passwordcredential">PasswordCredential</a></code> objects have an internal slot named
  <dfn class="idl-code" data-dfn-for="PasswordCredential" data-dfn-type="attribute" data-export="" id="dom-passwordcredential-password-slot">[[password]]<a class="self-link" href="#dom-passwordcredential-password-slot"></a></dfn> which stores the
  credential’s password. This property is not directly exposed to the web, but
  used to construct the <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#requestinit">RequestInit</a></code> object generated during
  <code class="idl"><a data-link-type="idl" href="#dom-passwordcredential-sendurl">send()</a></code>.</p>

  
    <h5 class="heading settled" data-level="3.1.2.1" id="passwordcredential-matching"><span class="secno">3.1.2.1. </span><span class="content">
    Matching Algorithm
  </span><a class="self-link" href="#passwordcredential-matching"></a></h5>


    <p><code class="idl"><a data-link-type="idl" href="#passwordcredential">PasswordCredential</a></code> objects' <a data-link-type="dfn" href="#options-matching-algorithm">options matching algorithm</a> always
  returns <code>Match</code>.</p>

  
    <h4 class="heading settled" data-level="3.1.3" id="interfaces-credential-types-federatedcredential"><span class="secno">3.1.3. </span><span class="content"><code>FederatedCredential</code></span><a class="self-link" href="#interfaces-credential-types-federatedcredential"></a></h4>
  
    <pre class="idl">dictionary <dfn class="idl-code" data-dfn-type="dictionary" data-export="" data-global-name="" id="dictdef-federatedcredentialdata">FederatedCredentialData<a class="self-link" href="#dictdef-federatedcredentialdata"></a></dfn> : <a data-link-type="idl-name" href="#dictdef-credentialdata">CredentialData</a> {
  USVString <dfn class="idl-code" data-dfn-for="FederatedCredentialData" data-dfn-type="dict-member" data-export="" data-global-name="FederatedCredentialData<dictionary>/provider<dict-member>" data-type="USVString " id="dom-federatedcredentialdata-provider">provider<a class="self-link" href="#dom-federatedcredentialdata-provider"></a></dfn>;
  DOMString? <dfn class="idl-code" data-dfn-for="FederatedCredentialData" data-dfn-type="dict-member" data-export="" data-global-name="FederatedCredentialData<dictionary>/protocol<dict-member>" data-type="DOMString? " id="dom-federatedcredentialdata-protocol">protocol<a class="self-link" href="#dom-federatedcredentialdata-protocol"></a></dfn>;
};

[<dfn class="idl-code" data-dfn-for="FederatedCredential" data-dfn-type="constructor" data-export="" data-global-name="FederatedCredential<interface>/FederatedCredential(data)<constructor>" data-lt="FederatedCredential(data)" id="dom-federatedcredential-federatedcredentialdata">Constructor<a class="self-link" href="#dom-federatedcredential-federatedcredentialdata"></a></dfn>(<a data-link-type="idl-name" href="#dictdef-federatedcredentialdata">FederatedCredentialData</a> <dfn class="idl-code" data-dfn-for="FederatedCredential/FederatedCredential(data)" data-dfn-type="argument" data-export="" data-global-name="FederatedCredential<interface>/FederatedCredential(data)<method>/data<argument>" id="dom-federatedcredential-federatedcredentialdata-data">data<a class="self-link" href="#dom-federatedcredential-federatedcredentialdata-data"></a></dfn>), Exposed=Window]
interface <dfn class="idl-code" data-dfn-type="interface" data-export="" data-global-name="" id="federatedcredential">FederatedCredential<a class="self-link" href="#federatedcredential"></a></dfn> {
  readonly attribute USVString <a class="idl-code" data-global-name="FederatedCredential<interface>/provider<attribute>" data-link-type="attribute" data-readonly="" data-type="USVString " href="#dom-federatedcredential-provider">provider</a>;
  readonly attribute DOMString? <a class="idl-code" data-global-name="FederatedCredential<interface>/protocol<attribute>" data-link-type="attribute" data-readonly="" data-type="DOMString? " href="#dom-federatedcredential-protocol">protocol</a>;
};
<a data-link-type="idl-name" href="#federatedcredential">FederatedCredential</a> implements <a data-link-type="idl-name" href="#locallystoredcredential">LocallyStoredCredential</a>;
</pre>
  
    <dl>
    
     <dt><dfn class="idl-code" data-dfn-for="FederatedCredential" data-dfn-type="attribute" data-export="" id="dom-federatedcredential-provider">provider<a class="self-link" href="#dom-federatedcredential-provider"></a></dfn>, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString">USVString</a>, readonly</span>
     
    
     <dd>
      The credential’s <a data-link-type="dfn" href="#federated-identity-provider">federated identity provider</a>. For details regarding
      valid formats, see <a href="#identifying-federations">§3.2.2 Identifying providers</a>.
    
     
    
     <dt><dfn class="idl-code" data-dfn-for="FederatedCredential" data-dfn-type="attribute" data-export="" id="dom-federatedcredential-protocol">protocol<a class="self-link" href="#dom-federatedcredential-protocol"></a></dfn>, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a>, readonly, nullable</span>
     
    
     <dd>
      The credential’s <a data-link-type="dfn" href="#federated-identity-provider">federated identity provider</a>’s protocol (e.g.
      "openidconnect"). If this value is <code>null</code>, then the protocol
      can be inferred from the <code class="idl"><a data-link-type="idl" href="#dom-federatedcredential-provider">provider</a></code>.
    
     
    
     <dt><code class="idl"><a data-link-type="idl" href="#dom-credential-type-slot">[[type]]</a></code>
     
    
     <dd>
      All <code class="idl"><a data-link-type="idl" href="#federatedcredential">FederatedCredential</a></code> objects have their <code class="idl"><a data-link-type="idl" href="#dom-credential-type-slot">[[type]]</a></code>
      slot’s value set to <code>federated</code>.
    
     
  
    </dl>

  
    <h5 class="heading settled" data-level="3.1.3.1" id="federatedcredential-matching"><span class="secno">3.1.3.1. </span><span class="content">
    Matching Algorithm
  </span><a class="self-link" href="#federatedcredential-matching"></a></h5>


    <p><code class="idl"><a data-link-type="idl" href="#federatedcredential">FederatedCredential</a></code> objects' <a data-link-type="dfn" href="#options-matching-algorithm">options matching algorithm</a> is as
  follows. Given a <code class="idl"><a data-link-type="idl" href="#federatedcredential">FederatedCredential</a></code> (<var>credential</var>) and a
  <code class="idl"><a data-link-type="idl" href="#dom-credentialrequest-options">options</a></code> (<var>options</var>):</p>

  
    <ol>
    
     <li>
      If <var>options</var> has a
      <code class="idl"><a data-link-type="idl" href="#dom-federatedcredentialrequestoptions-providers">providers</a></code> property:

      
      <ol>
        
       <li>
          For each <var>provider</var> in <var>options</var>'
          <code>providers</code> list:

          
        <ol>
            
         <li>
              Return <code>Matches</code> if <var>credential</var>’s
              <code class="idl"><a data-link-type="idl" href="#dom-federatedcredential-provider">provider</a></code> is a case-sensitive match for
              <var>provider</var>.
            
         
          
        </ol>
        
        
       
      
      </ol>
      
    
     
    
     <li>
      If <var>options</var> has a
      <code class="idl"><a data-link-type="idl" href="#dom-federatedcredentialrequestoptions-protocols">protocols</a></code> property:

      
      <ol>
        
       <li>
          For each <var>protocol</var> in <var>options</var>'
          <code class="idl"><a data-link-type="idl" href="#dom-federatedcredentialrequestoptions-protocols">protocols</a></code> list:

          
        <ol>
            
         <li>
              Return <code>Matches</code> if <var>credential</var>’s
              <code class="idl"><a data-link-type="idl" href="#dom-federatedcredential-protocol">protocol</a></code> is a case-insensitive match for
              <var>protocol</var>.
            
         
          
        </ol>
        
        
       
      
      </ol>
      
    
     
    
     <li>
      Return <code>Does Not Match</code>.
    
     
  
    </ol>

  
    <h3 class="heading settled" data-level="3.2" id="interfaces-credential-manager"><span class="secno">3.2. </span><span class="content">Credential Manager</span><a class="self-link" href="#interfaces-credential-manager"></a></h3>


    <p>The credential manager hangs off of the <code class="idl"><a data-link-type="idl" href="http://www.w3.org/TR/html5/webappapis.html#navigator">Navigator</a></code> object, and exposes
  methods to request credentials, and to notify the user agent when interesting
  events occur: successful sign in and sign out.</p>

  
    <pre class="idl">partial interface <a class="idl-code" data-link-type="interface" href="http://www.w3.org/TR/html5/webappapis.html#navigator">Navigator</a> {
  readonly attribute <a data-link-type="idl-name" href="#credentialcontainer">CredentialContainer</a> <dfn class="idl-code" data-dfn-for="Navigator" data-dfn-type="attribute" data-export="" data-global-name="Navigator<interface>/credentials<attribute>" data-readonly="" data-type="CredentialContainer " id="dom-navigator-credentials">credentials<a class="self-link" href="#dom-navigator-credentials"></a></dfn>;
};

interface <dfn class="idl-code" data-dfn-type="interface" data-export="" data-global-name="" id="credentialcontainer">CredentialContainer<a class="self-link" href="#credentialcontainer"></a></dfn> {
  Promise&lt;<a data-link-type="idl-name" href="#credential">Credential</a>?> <a class="idl-code" data-global-name="CredentialContainer<interface>/get(request)<method>/get()<method>" data-link-type="method" href="#dom-credentialcontainer-getrequest">get</a>(optional <a data-link-type="idl-name" href="#dictdef-credentialrequest">CredentialRequest</a> <dfn class="idl-code" data-dfn-for="CredentialContainer/get(request)" data-dfn-type="argument" data-export="" data-global-name="CredentialContainer<interface>/get(request)<method>/request<argument>" id="dom-credentialcontainer-getrequest-request">request<a class="self-link" href="#dom-credentialcontainer-getrequest-request"></a></dfn>);
  Promise&lt;<a data-link-type="idl-name" href="#credential">Credential</a>> <a class="idl-code" data-global-name="CredentialContainer<interface>/store(credential)<method>/store()<method>" data-link-type="method" href="#dom-credentialcontainer-storecredential">store</a>(optional <a data-link-type="idl-name" href="#credential">Credential</a> <dfn class="idl-code" data-dfn-for="CredentialContainer/store(credential)" data-dfn-type="argument" data-export="" data-global-name="CredentialContainer<interface>/store(credential)<method>/credential<argument>" id="dom-credentialcontainer-storecredential-credential">credential<a class="self-link" href="#dom-credentialcontainer-storecredential-credential"></a></dfn>);
  Promise&lt;void> <a class="idl-code" data-global-name="CredentialContainer<interface>/requireUserMediation()<method>" data-link-type="method" href="#dom-credentialcontainer-requireusermediation">requireUserMediation</a>();
};
</pre>
  
    <dl>
    
     <dt><dfn class="idl-code" data-dfn-for="CredentialContainer" data-dfn-type="method" data-export="" data-lt="get(request)|get()" id="dom-credentialcontainer-getrequest">get()<a class="self-link" href="#dom-credentialcontainer-getrequest"></a></dfn>
     
    
     <dd>
      Request a credential from the credential manager. The user agent MUST
      execute the algorithm defined in <a href="#request-credential">§4.1.1 
    Request a Credential
  </a> with
      <var>request</var> as an argument.


      <p class="note" role="note">Note: If and when we need to support returning more than a single
      credential in response to a single call, we will likely introduce a
      <code>getAll()</code> method which would return
      <code>Promise&lt;sequence&lt;Credential>></code>.</p>
      
    
     
    
     <dt><dfn class="idl-code" data-dfn-for="CredentialContainer" data-dfn-type="method" data-export="" data-lt="store(credential)|store()" id="dom-credentialcontainer-storecredential">store()<a class="self-link" href="#dom-credentialcontainer-storecredential"></a></dfn>
     
    
     <dd>
      Ask the credential manager to store a <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> for the user. Authors
      could call this method after a user successfully signs in, or after a
      successful password change operation.


      <p>When <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-storecredential">store()</a></code> is called, the user agent MUST execute the algorithm
      defined in <a href="#store-credential">§4.1.2 
    Store a Credential
  </a> with <var>credential</var> as an
      argument.</p>
      
    
     
    
     <dt><dfn class="idl-code" data-dfn-for="CredentialContainer" data-dfn-type="method" data-export="" id="dom-credentialcontainer-requireusermediation">requireUserMediation()<a class="self-link" href="#dom-credentialcontainer-requireusermediation"></a></dfn>
     
    
     <dd>
      Ask the credential manager to require user mediation before returning
      credentials for the origin in which the method is called. This might be
      called after a user signs out of a website, for instance, in order to
      ensure that she isn’t automatically signed back in next time she visits.


      <p>When <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-requireusermediation">requireUserMediation()</a></code> is called, the user agent MUST execute the
      algorithm defined in <a href="#require-user-mediation-for-origin">§4.2.6 
    Require user mediation for origin
  </a> with the
      <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a> of the <a data-link-type="dfn" href="http://www.w3.org/TR/html5/webappapis.html#incumbent-settings-object">incumbent settings object</a> in which this method
      is called.</p>
      
    
     
  
    </dl>


    <p class="issue" id="issue-69471d6f"><a class="self-link" href="#issue-69471d6f"></a>We should support explicit sign-up via
  <code class="idl"><a data-link-type="idl" href="#passwordcredential">PasswordCredential</a></code>s with generated passwords. Perhaps something similar to
  iOS8’s <code>SecCreateSharedWebCredentialPassword</code>. <a href="https://github.com/w3c/webappsec/issues/250">&lt;https://github.com/w3c/webappsec/issues/250></a></p>

  
    <h4 class="heading settled" data-level="3.2.1" id="interfaces-request-options"><span class="secno">3.2.1. </span><span class="content">
    <code>get()</code> Parameters
  </span><a class="self-link" href="#interfaces-request-options"></a></h4>


    <p>In order to obtain the desired <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> via
  <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-getrequest">get()</a></code>, the caller specifies a few parameters in a
  <code class="idl"><a data-link-type="idl" href="#dictdef-credentialrequest">CredentialRequest</a></code> dictionary.</p>


    <p class="note" role="note">Note: The <code class="idl"><a data-link-type="idl" href="#typedefdef-credentialrequestoptions">CredentialRequestOptions</a></code> typedef is an extension point. If and
  when new types of credentials are introduced that require options, their
  dictionary types will be added to the typedef so they can be passed into the
  request.</p>

  
    <pre class="idl">dictionary <dfn class="idl-code" data-dfn-type="dictionary" data-export="" data-global-name="" id="dictdef-federatedcredentialrequestoptions">FederatedCredentialRequestOptions<a class="self-link" href="#dictdef-federatedcredentialrequestoptions"></a></dfn> {
  sequence&lt;USVString> <a class="idl-code" data-global-name="FederatedCredentialRequestOptions<dictionary>/providers<dict-member>" data-link-type="dict-member" data-type="sequence<USVString> " href="#dom-federatedcredentialrequestoptions-providers">providers</a>;
  sequence&lt;DOMString> <dfn class="idl-code" data-dfn-for="FederatedCredentialRequestOptions" data-dfn-type="dict-member" data-export="" data-global-name="FederatedCredentialRequestOptions<dictionary>/protocols<dict-member>" data-type="sequence<DOMString> " id="dom-federatedcredentialrequestoptions-protocols">protocols<a class="self-link" href="#dom-federatedcredentialrequestoptions-protocols"></a></dfn>;
};

typedef <a data-link-type="idl-name" href="#dictdef-federatedcredentialrequestoptions">FederatedCredentialRequestOptions</a> <dfn class="idl-code" data-dfn-type="typedef" data-export="" data-global-name="" id="typedefdef-credentialrequestoptions">CredentialRequestOptions<a class="self-link" href="#typedefdef-credentialrequestoptions"></a></dfn>;

dictionary <dfn class="idl-code" data-dfn-type="dictionary" data-export="" data-global-name="" id="dictdef-credentialrequest">CredentialRequest<a class="self-link" href="#dictdef-credentialrequest"></a></dfn> {
  <a data-link-type="idl-name" href="#typedefdef-credentialrequestoptions">CredentialRequestOptions</a> <a class="idl-code" data-global-name="CredentialRequest<dictionary>/options<dict-member>" data-link-type="dict-member" data-type="CredentialRequestOptions " href="#dom-credentialrequest-options">options</a>;
  boolean <a class="idl-code" data-default="false" data-global-name="CredentialRequest<dictionary>/suppressUI<dict-member>" data-link-type="dict-member" data-type="boolean " href="#dom-credentialrequest-suppressui">suppressUI</a> = false;
  sequence&lt;DOMString> <a class="idl-code" data-global-name="CredentialRequest<dictionary>/types<dict-member>" data-link-type="dict-member" data-type="sequence<DOMString> " href="#dom-credentialrequest-types">types</a>;
};
</pre>
  
    <dl>
    
     <dt><dfn class="idl-code" data-dfn-for="FederatedCredentialRequestOptions" data-dfn-type="dict-member" data-export="" id="dom-federatedcredentialrequestoptions-providers">providers<a class="self-link" href="#dom-federatedcredentialrequestoptions-providers"></a></dfn>, <span> of type sequence&lt;<a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-USVString">USVString</a>></span>
     
    
     <dd>
      An array of federation identifiers. For details regarding valid formats
      see <a href="#identifying-federations">§3.2.2 Identifying providers</a>.
    
     
  
    </dl>
  
    <dl>
    
     <dt><dfn class="idl-code" data-dfn-for="CredentialRequest" data-dfn-type="dict-member" data-export="" id="dom-credentialrequest-types">types<a class="self-link" href="#dom-credentialrequest-types"></a></dfn>, <span> of type sequence&lt;<a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a>></span>
     
    
     <dd>
      A sequence of strings specifying the types of <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> objects which
      the caller wishes to obtain. An empty sequence signifies that the caller
      will accept any credential type. For processing details, see the algorithm
      defined in <a href="#request-credential">§4.1.1 
    Request a Credential
  </a>.
    
     
    
     <dt><dfn class="idl-code" data-dfn-for="CredentialRequest" data-dfn-type="dict-member" data-export="" id="dom-credentialrequest-suppressui">suppressUI<a class="self-link" href="#dom-credentialrequest-suppressui"></a></dfn>, <span> of type <a data-link-type="idl-name" href="https://heycam.github.io/webidl/#idl-boolean">boolean</a>, defaulting to <code>false</code></span>
     
    
     <dd>
      If <code>true</code>, the user agent will only attempt to provide a
      <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> without user interaction: if the user has explicitly
      opted-into always giving a particular site access to a particular set of
      credentials, they will be provided. If not, the promise will resolve with
      <code>undefined</code>. For processing details, see the algorithm defined
      in <a href="#request-credential">§4.1.1 
    Request a Credential
  </a>.
    
     
    
     <dt><dfn class="idl-code" data-dfn-for="CredentialRequest" data-dfn-type="dict-member" data-export="" id="dom-credentialrequest-options">options<a class="self-link" href="#dom-credentialrequest-options"></a></dfn>, <span> of type <a data-link-type="idl-name" href="#typedefdef-credentialrequestoptions">CredentialRequestOptions</a></span>
     
    
     <dd>
      An dictionary containing a set of parameters which will be used to select
      a particular <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> to return. This process is described in each
      <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> type’s <a data-link-type="dfn" href="#options-matching-algorithm">options matching algorithm</a>.
    
     
  
    </dl>

  
    <div class="example" id="example-d3b10081"><a class="self-link" href="#example-d3b10081"></a>
    Suppose <code>https://example.com/</code> only supports federated sign-in
    via <code>https://identity.example.com/</code>. It could request credentials
    via the following call:

    
     <pre>navigator.<a data-link-type="idl" href="#dom-navigator-credentials">credentials</a>.<a data-link-type="idl" href="#dom-credentialcontainer-getrequest">get</a>({
  "<a data-link-type="idl" href="#dom-credentialrequest-types">types</a>": [ "federated" ],
  "<a data-link-type="idl" href="#dom-credentialrequest-options">options</a>": {
      "<a data-link-type="idl" href="#dom-federatedcredentialrequestoptions-providers">providers</a>": [ "https://identity.example.com/" ]
  }
}).then(function (credential) {
  // ...
});
</pre>
     


     <p>If it wanted to ensure that the user agent didn’t bother the user with
    questions, it could ask to suppress UI for the request (and, therefore,
    to receive <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code>s if and only if the user had chosen to
    automatically sign into the origin):</p>
     

    
     <pre>navigator.<a data-link-type="idl" href="#dom-navigator-credentials">credentials</a>.<a data-link-type="idl" href="#dom-credentialcontainer-getrequest">get</a>({
  "<a data-link-type="idl" href="#dom-credentialrequest-types">types</a>": [ "federated" ],
  "<a data-link-type="idl" href="#dom-credentialrequest-options">options</a>": {
      "<a data-link-type="idl" href="#dom-federatedcredentialrequestoptions-providers">providers</a>": [ "https://identity.example.com/" ]
  },
  "<a data-link-type="idl" href="#dom-credentialrequest-suppressui">suppressUI</a>": true
}).then(function (credential) {
  // ...
});
</pre>
     
  
    </div>

  
    <h4 class="heading settled" data-level="3.2.2" id="identifying-federations"><span class="secno">3.2.2. </span><span class="content">Identifying providers</span><a class="self-link" href="#identifying-federations"></a></h4>


    <p>Every site should use the same identifier when referring to a specific
  <a data-link-type="dfn" href="#federated-identity-provider">federated identity provider</a>. For example,
  <a href="https://developers.facebook.com/docs/facebook-login/v2.0">Facebook Login</a>
  shouldn’t be "Facebook" and "Facebook Login" and "FB" and "FBL" and
  "Facebook.com" and so on. It should have a canonical identifier which everyone
  can make use of, as consistent identification makes it possible for user
  agents to be helpful.</p>


    <p>For consistency, federations passed into the APIs defined in this document
  (e.g. <code class="idl"><a data-link-type="idl" href="#dictdef-federatedcredentialrequestoptions">FederatedCredentialRequestOptions</a></code>'s
  <code class="idl"><a data-link-type="idl" href="#dom-federatedcredentialrequestoptions-providers">providers</a></code> array, or
  <code class="idl"><a data-link-type="idl" href="#federatedcredential">FederatedCredential</a></code>'s <code class="idl"><a data-link-type="idl" href="#dom-federatedcredential-provider">provider</a></code> property)
  MUST be identified by the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-6.2">ASCII serialization</a> of the origin the
  provider uses for sign in. That is, Facebook would be represented by
  <code>https://www.facebook.com</code> and Google by
  <code>https://accounts.google.com</code>.</p>


    <p>The ASCII serialization of an origin does <em>not</em> include a trailing
  U+002F SOLIDUS ("<code>/</code>"), but user agents SHOULD accept them
  silently: <code>https://accounts.google.com/</code> is clearly intended to
  be the same as <code>https://accounts.google.com</code>.</p>
</section>



   <section>
  
    <h2 class="heading settled" data-level="4" id="algorithms"><span class="secno">4. </span><span class="content">Algorithms</span><a class="self-link" href="#algorithms"></a></h2>

  
    <h3 class="heading settled" data-level="4.1" id="processing"><span class="secno">4.1. </span><span class="content">
    Processing <code>Credential</code>s
  </span><a class="self-link" href="#processing"></a></h3>

  
    <h4 class="heading settled" data-level="4.1.1" id="request-credential"><span class="secno">4.1.1. </span><span class="content">
    Request a <code>Credential</code>
  </span><a class="self-link" href="#request-credential"></a></h4>


    <p>Given a <code class="idl"><a data-link-type="idl" href="#dictdef-credentialrequest">CredentialRequest</a></code> object (<var>request</var>), this
  algorithm returns a <code>Promise</code> which resolves with either a
  single <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> object if one can be obtained, or <code>undefined</code>
  if not.</p>


    <p>If called from an environment which is not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec/specs/powerfulfeatures/#privileged-context">privileged context</a>, or
  from somewhere other than a <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context">top-level browsing context</a>, the
  <code>Promise</code> will be rejected with a <code>NotSupportedError</code>.</p>

  
    <ol>
    
     <li>
      Let <var>settings</var> be the <a data-link-type="dfn" href="http://www.w3.org/TR/html5/webappapis.html#incumbent-settings-object">incumbent settings object</a>.
    
     
    
     <li>
      Let <var>origin</var> be <var>settings</var>' <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a>.
    
     
    
     <li>
      Return a <code>Promise</code> rejected with <code>NotSupportedError</code>
      if any of the following statements are true:

      
      <ol>
        
       <li>
          <var>settings</var> does not have a <a data-link-type="dfn" href="http://www.w3.org/TR/html5/webappapis.html#responsible-document">responsible document</a>
        
       
        
       <li>
          <var>settings</var>' <a data-link-type="dfn" href="http://www.w3.org/TR/html5/webappapis.html#responsible-document">responsible document</a> is not the
          <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#active-document">active document</a> in the <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context">top-level browsing context</a>
        
       
        
       <li>
          <var>settings</var> is not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec/specs/powerfulfeatures/#privileged-context">privileged context</a>
        
       
      
      </ol>
      
    
     
    
     <li>
      Let <var>type</var> be lowest common ancestor interface of the types
      referenced in <var>request</var>’s <code class="idl"><a data-link-type="idl" href="#dom-credentialrequest-types">types</a></code> property.


      <p class="issue" id="issue-6005a2a4"><a class="self-link" href="#issue-6005a2a4"></a>This is terribly hand-wavey. The intent is
      clear, but I need to do the work to walk through the list of DOMStrings
      and convert them to interfaces and etc. Busywork for later. <a href="https://github.com/w3c/webappsec/issues/289">&lt;https://github.com/w3c/webappsec/issues/289></a></p>
      
    
     
    
     <li>
      Return a <code>Promise</code> rejected with <code>TypeMismatchError</code>
      if <var>type</var> is <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code>.
    
     
    
     <li>
      Let <var>promise</var> be a newly created <code>Promise</code> object.
    
     
    
     <li>
      Return <var>promise</var>, and execute the remaining steps asynchronously.
    
     
    
     <li>
      Switch on <var>type</var>, and execute the associated steps:

      
      <dl>
        
       <dt><code class="idl"><a data-link-type="idl" href="#locallystoredcredential">LocallyStoredCredential</a></code>
       
        
       <dd>
          
        <ol>
            
         <li>
              Let <var>result</var> be the result of executing
              <a href="#request-locallystoredcredential-without-mediation">§4.2.2 
    Request a LocallyStoredCredential without user mediation
  </a>,
              passing in <var>origin</var>, <var>request</var>’s
              <code class="idl"><a data-link-type="idl" href="#dom-credentialrequest-types">types</a></code> property, and
              <var>request</var>’s <code class="idl"><a data-link-type="idl" href="#dom-credentialrequest-options">options</a></code> property.
            
         
            
         <li>
              If <var>result</var> is not <code>null</code>, resolve
              <var>promise</var> with <var>result</var>, and terminate this
              algorithm.
            
         
            
         <li>
              If <var>request</var>’s <code class="idl"><a data-link-type="idl" href="#dom-credentialrequest-suppressui">suppressUI</a></code>
              is <code>true</code>, resolve <var>promise</var> with
              <var>undefined</var>, and terminate this algorithm.
            
         
            
         <li>
              If this algorithm would not be <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#allowed-to-show-a-popup">allowed to show a popup</a>,
              then reject <var>promise</var> with a <code>SecurityError</code>
              and terminate this algorithm.


          <p class="note" role="note">Note: This boils down to requiring a user gesture for <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-getrequest">get()</a></code>
              before showing the user any UI.</p>
          
            
         
            
         <li>
              Resolve <var>promise</var> with the result of executing
              <a href="#request-locallystoredcredential-with-mediation">§4.2.3 
    Request a LocallyStoredCredential with user mediation
  </a>,
              passing in <var>origin</var>, <var>request</var>'
              <code class="idl"><a data-link-type="idl" href="#dom-credentialrequest-types">types</a></code> property, and
              <var>request</var>' <code class="idl"><a data-link-type="idl" href="#dom-credentialrequest-options">options</a></code> property.
            
         
          
        </ol>
        
        
       

        
       <dt><em>This is an extension point.</em>
       
        
       <dd>
          When new credential types are defined in the future, they’ll go here.
        
       
      
      </dl>
      
    
     
  
    </ol>


    <p class="issue" id="issue-d98444f7"><a class="self-link" href="#issue-d98444f7"></a>How do we deal with a future in which
  <code class="idl"><a data-link-type="idl" href="#locallystoredcredential">LocallyStoredCredential</a></code> isn’t the only type? For example, how could an
  author pull some "RemoteCredential" that required interaction with a
  third-party, but fall back to a <code class="idl"><a data-link-type="idl" href="#passwordcredential">PasswordCredential</a></code>? For the moment, we’re
  resolving this by rejecting the promise if the types listed in
  <code class="idl"><a data-link-type="idl" href="#dom-credentialrequest-types">types</a></code> aren’t all instances of the same type, but that
  seems like something we’d want to fix. <a href="https://github.com/w3c/webappsec/issues/256">&lt;https://github.com/w3c/webappsec/issues/256></a></p>

  
    <h4 class="heading settled" data-level="4.1.2" id="store-credential"><span class="secno">4.1.2. </span><span class="content">
    Store a <code>Credential</code>
  </span><a class="self-link" href="#store-credential"></a></h4>


    <p>Given a <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> object (<var>credential</var>), this algorithm executes
  a type-specific storage algorithm. <code class="idl"><a data-link-type="idl" href="#locallystoredcredential">LocallyStoredCredential</a></code> objects will
  be persisted to the user agent’s <a data-link-type="dfn" href="#credential-store">credential store</a>. Future object types
  could, for instance, be persisted to some other (potentially remote) storage
  mechanism.</p>


    <p>If called from an environment which is not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec/specs/powerfulfeatures/#privileged-context">privileged context</a>, or
  from somewhere other than a <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context">top-level browsing context</a>, the
  <code>Promise</code> will be rejected with a <code>NotSupportedError</code>.</p>

  
    <ol>
    
     <li>
      Let <var>settings</var> be the <a data-link-type="dfn" href="http://www.w3.org/TR/html5/webappapis.html#incumbent-settings-object">incumbent settings object</a>.
    
     
    
     <li>
      Let <var>origin</var> be <var>settings</var>' <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a>.
    
     
    
     <li>
      Return a <code>Promise</code> rejected with <code>NotSupportedError</code>
      if any of the following statements are true:

      
      <ol>
        
       <li>
          <var>settings</var> does not have a <a data-link-type="dfn" href="http://www.w3.org/TR/html5/webappapis.html#responsible-document">responsible document</a>
        
       
        
       <li>
          <var>settings</var>' <a data-link-type="dfn" href="http://www.w3.org/TR/html5/webappapis.html#responsible-document">responsible document</a> is not the
          <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#active-document">active document</a> in the <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context">top-level browsing context</a>
        
       
        
       <li>
          <var>settings</var> is not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec/specs/powerfulfeatures/#privileged-context">privileged context</a>
        
       
      
      </ol>
      
    
     
    
     <li>
      Let <var>promise</var> be a newly created <code>Promise</code> object.
    
     
    
     <li>
      Return <var>promise</var>, and execute the remaining steps asynchronously.
    
     
    
     <li>
      Switch on <var>type</var>, and execute the associated steps:

      
      <dl>
        
       <dt><code class="idl"><a data-link-type="idl" href="#locallystoredcredential">LocallyStoredCredential</a></code>
       
        
       <dd>
          
        <ol>
            
         <li>
              Resolve <var>promise</var> with the result of executing
              <a href="#store-locallystoredcredential">§4.2.5 
    Store LocallyStoredCredential
  </a>,
              passing in <var>credential</var> and <var>origin</var>.
            
         
          
        </ol>
        
        
       

        
       <dt><em>This is an extension point.</em>
       
        
       <dd>
          When new credential types are defined in the future, they’ll go here.
        
       
      
      </dl>
      
    
     
  
    </ol>

  
    <h3 class="heading settled" data-level="4.2" id="processing-locallystored"><span class="secno">4.2. </span><span class="content">
    Processing <code>LocallyStoredCredential</code>s
  </span><a class="self-link" href="#processing-locallystored"></a></h3>

  
    <h4 class="heading settled" data-level="4.2.1" id="gather-locallystoredcredentials"><span class="secno">4.2.1. </span><span class="content">
    Gather <code>LocallyStoredCredential</code>s
  </span><a class="self-link" href="#gather-locallystoredcredentials"></a></h4>


    <p>Given an <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a> (<var>origin</var>), and a sequence of <code class="idl"><a data-link-type="idl" href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a></code>
  (<var>types</var>), and an <code class="idl"><a data-link-type="idl" href="#dom-credentialrequest-options">options</a></code> dictionary
  (<var>options</var>), this algorithm returns a sequence of
  <code class="idl"><a data-link-type="idl" href="#locallystoredcredential">LocallyStoredCredential</a></code> from the user agent’s <a data-link-type="dfn" href="#credential-store">credential store</a>
  which are potential candidates:</p>

  
    <ol>
    
     <li>
      Let <var>credentials</var> be the set of <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> objects in the
      <a data-link-type="dfn" href="#credential-store">credential store</a> whose <code class="idl"><a data-link-type="idl" href="#dom-locallystoredcredential-origin-slot">[[origin]]</a></code> slot is equal to the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-6.2">ASCII
      serialization</a> of <var>origin</var>.


      <p class="note" role="note">Note: This is an exact match, not a <a data-link-type="dfn" href="https://publicsuffix.org/list/#">registerable domain</a> match.
      See <a href="#security-cross-origin-leakage">§6.1 Cross-origin Credential Leakage</a> for details as to why.</p>
      
    
     
    
     <li>
      The user agent MAY synthesize <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> objects to add to the list
      based on vendor-specific heuristics (as described in <a href="#synthesis">§5.3.1 Synthesizing Credentials</a>).
    
     
    
     <li>
      Remove any items from <var>credentials</var> whose <code class="idl"><a data-link-type="idl" href="#dom-credential-type">type</a></code>
      property is not a case-sensitive match for a value in <var>types</var>.
    
     
    
     <li>
      Remove any items from <var>credentials</var> whose <a data-link-type="dfn" href="#options-matching-algorithm">options matching
      algorithm</a> returns <code>Does Not Match</code> when executed on
      <var>options</var>.
    
     
    
     <li>
      Return <var>credentials</var>.
    
     
  
    </ol>

  
    <h4 class="heading settled" data-level="4.2.2" id="request-locallystoredcredential-without-mediation"><span class="secno">4.2.2. </span><span class="content">
    Request a <code>LocallyStoredCredential</code> <em>without</em> user mediation
  </span><a class="self-link" href="#request-locallystoredcredential-without-mediation"></a></h4>


    <p>This algorithm accepts an <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a> (<var>origin</var>), a sequence of
  type names (<var>types</var>) and an <code class="idl"><a data-link-type="idl" href="#dom-credentialrequest-options">options</a></code> dictionary
  (<var>options</var>), and returns either a single <code class="idl"><a data-link-type="idl" href="#locallystoredcredential">LocallyStoredCredential</a></code>
  object <strong>if and only if</strong> one can be provided without user
  mediation, or <code>null</code> if not.</p>

  
    <ol>
    
     <li>
      If the user agent has disabled sharing credentials without user
      mediation, or <var>origin</var>’s <a data-link-type="dfn" href="#requires-user-mediation">requires user mediation</a> flag
      in the user agent’s <a data-link-type="dfn" href="#credential-store">credential store</a> is <code>true</code>, return
      <code>null</code>.


      <p class="note" role="note">Note: See <a href="#user-mediation-requirements">§5.2 Requiring User Mediation</a> for details.</p>
      
    
     
    
     <li>
      Let <var>credentials</var> be the result of executing
      <a href="#gather-locallystoredcredentials">§4.2.1 
    Gather LocallyStoredCredentials
  </a> on <var>origin</var>,
      <var>types</var>, and <var>options</var>.
    
     
    
     <li>
      If <var>credentials</var> is empty, or contains more than one
      <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> object, return <code>null</code>.


      <p class="note" role="note">Note: In the future, we may wish to allow multiple <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> objects
      to be returned; for the moment, we’re erring on the cautious side to avoid
      accidentally revealing explicit relationships between user accounts.</p>
      
    
     
    
     <li>
      Otherwise, let <var>credential</var> be the single <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> object
      in <var>credentials</var>.
    
     
    
     <li>
      Return <var>credential</var>.
    
     
  
    </ol>


    <p class="note" role="note">Note: If a user agent implements some sort of "private browsing" mode, we
  recommend that this algorithm always return <code>null</code> when the user
  has enabled private browsing.</p>

  
    <h4 class="heading settled" data-level="4.2.3" id="request-locallystoredcredential-with-mediation"><span class="secno">4.2.3. </span><span class="content">
    Request a <code>LocallyStoredCredential</code> with user mediation
  </span><a class="self-link" href="#request-locallystoredcredential-with-mediation"></a></h4>


    <p>This algorithm accepts an <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a> (<var>origin</var>), a sequence of
  type names (<var>types</var>) and an <code class="idl"><a data-link-type="idl" href="#dom-credentialrequest-options">options</a></code> dictionary
  (<var>options</var>), and returns either a single <code class="idl"><a data-link-type="idl" href="#locallystoredcredential">LocallyStoredCredential</a></code>
  object, or <code>null</code> if none can be provided.</p>

  
    <ol>
    
     <li>
      Let <var>credentials</var> be the result of executing
      <a href="#gather-locallystoredcredentials">§4.2.1 
    Gather LocallyStoredCredentials
  </a> on <var>origin</var>,
      <var>types</var>, and <var>options</var>.
    
     
      This requirement only applies if we would show UI to the user.
      If she’s elected to allow credentials to be provided without user
      mediation, and we can do so, then we don’t require a user gesture
      for <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-getrequest">get()</a></code>. Otherwise, we do, due to the considerations in
      <a href="#privacy-considerations">§7 Privacy Considerations</a>.
    
    
     <li>
      Ask the user which <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> to share.


      <p class="note" role="note">Note: This behavior is vendor-specific. Guidelines for user agent
      behavior are presented in <a href="#user-mediation">§5 User Mediation</a>.</p>
      
    
     
    
     <li>
      Let <var>credential</var> be the <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> the user chose, or
      <code>null</code> if the user chose not to share a credential with
      <var>origin</var>.
    
     
    
     <li>
      Return <var>credential</var>.
    
     
  
    </ol>

  
    <h4 class="heading settled" data-level="4.2.4" id="send-passwordcredential"><span class="secno">4.2.4. </span><span class="content">
    Send <var>passwordCredential</var> to <var>url</var>.
  </span><a class="self-link" href="#send-passwordcredential"></a></h4>


    <p>Given an endpoint URL (<var>url</var>) this method will <code>POST</code>
  the credential information from a <code class="idl"><a data-link-type="idl" href="#passwordcredential">PasswordCredential</a></code> (<var>credential</var>)
  to <var>url</var>. In order to mitigate the risk of data leakage,
  <var>url</var> MUST be same-origin with <var>credential</var>’s
  internal <code class="idl"><a data-link-type="idl" href="#dom-locallystoredcredential-origin-slot">[[origin]]</a></code> slot.</p>

  
    <ol>
    
     <li>
      Let <var>endpoint</var> be the result of running <var>url</var> through
      the <a data-link-type="dfn" href="http://www.w3.org/TR/url/#concept-url-parser">URL parser</a>.
    
     
    
     <li>
      Return a promise rejected with a <code>TypeError</code> if
      <var>endpoint</var> is not a valid <code class="idl"><a data-link-type="idl" href="http://www.w3.org/TR/url/#dom-url">URL</a></code> <strong>and</strong> terminate
      this algorithm.
    
     
    
     <li>
      Let <var>environment</var> be the <a data-link-type="dfn" href="http://www.w3.org/TR/html5/webappapis.html#incumbent-settings-object">incumbent settings object</a>.
    
     
    
     <li>
      Return a promise rejected with a <code>SecurityError</code>
      <strong>and</strong> terminate this algorithm if any of the following
      conditions are true:

      
      <ol>
        
       <li>
          <a href="#is-match">§4.2.7 
    Does credential match origin B?
  </a> returns <code>No Match</code> when executed upon
          <var>credential</var> and <var>endpoint</var>’s <code class="idl"><a data-link-type="idl" href="http://www.w3.org/TR/url/#concept-url-origin">origin</a></code>.
        
       
        
       <li>
          <a href="#is-match">§4.2.7 
    Does credential match origin B?
  </a> returns <code>No Match</code> when executed upon
          <var>credential</var> and <var>environment</var>’s <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a>.
        
       
        
       <li>
          <var>environment</var>’s <a data-link-type="dfn" href="http://www.w3.org/TR/html5/webappapis.html#responsible-browsing-context">responsible browsing context</a> is not a
          <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context">top-level browsing context</a>
        
       
        
       <li>
          <var>environment</var> is not a <a data-link-type="dfn" href="https://w3c.github.io/webappsec/specs/powerfulfeatures/#privileged-context">privileged context</a>
        
       
      
      </ol>
      


      <p class="note" role="note">Note: We reject the promise here if <code class="idl"><a data-link-type="idl" href="#dom-passwordcredential-sendurl">send()</a></code> is called on an origin that
      isn’t at least a <a data-link-type="dfn" href="https://publicsuffix.org/list/#">registerable domain</a>-match with the credential’s
      origin, and in a context that meets the same requirement. That is,
      <code>https://admin.nytimes.com/</code> could submit credentials to
      <code>https://myaccount.example.com/</code>.</p>
      
    
     
    
     <li>
      Let <var>init</var> be a new <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#requestinit">RequestInit</a></code> object whose
      <code>credentials</code> member is set to "<code>same-origin</code>",
      <code>mode</code> member is set to "<code>POST</code>",
      <code>redirect</code> member is set to "<code>error</code>", and
      <code>body</code> member is a new <code class="idl"><a data-link-type="idl" href="https://xhr.spec.whatwg.org/#interface-formdata">FormData</a></code> object.


      <p class="issue" id="issue-b97befdf"><a class="self-link" href="#issue-b97befdf"></a>Should we introduce a new Fetch context?
      <code>credential</code> or something? <a href="https://github.com/w3c/webappsec/issues/231">&lt;https://github.com/w3c/webappsec/issues/231></a></p>
      
    
     
    
     <li>
      Execute the initial value of <code class="idl"><a data-link-type="idl" href="https://xhr.spec.whatwg.org/#dom-formdata-append">append()</a></code> on <var>init</var>’s
      <code>body</code> member, with a <code>name</code> of
      "<code>username</code>", and a <code>value</code> of
      <var>credential</var>’s <code class="idl"><a data-link-type="idl" href="#dom-passwordcredential-password-slot">[[password]]</a></code> slot.
    
     
    
     <li>
      Execute the initial value of <code class="idl"><a data-link-type="idl" href="https://xhr.spec.whatwg.org/#dom-formdata-append">append()</a></code> on <var>init</var>’s
      <code>body</code> member, with a <code>name</code> of
      "<code>password</code>", and a <code>value</code> of
      <var>credential</var>’s <code class="idl"><a data-link-type="idl" href="#dom-passwordcredential-password-slot">[[password]]</a></code> slot.
    
     
    
     <li>
      Return the promise that results from executing the initial value of
      <code class="idl"><a data-link-type="idl" href="https://fetch.spec.whatwg.org/#dom-global-fetch">fetch()</a></code> on <var>url</var> and <var>init</var>.
    
     
  
    </ol>

  
    <h4 class="heading settled" data-level="4.2.5" id="store-locallystoredcredential"><span class="secno">4.2.5. </span><span class="content">
    Store <code>LocallyStoredCredential</code>
  </span><a class="self-link" href="#store-locallystoredcredential"></a></h4>


    <p>This algorithm accepts a <code class="idl"><a data-link-type="idl" href="#locallystoredcredential">LocallyStoredCredential</a></code> (<var>credential</var>),
  and an <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a> (<var>origin</var>), and hands it to the internal
  credential manager for processing. It returns <var>credential</var> regardless
  of whether the user allows or disallows the credential to be persisted to the
  <a data-link-type="dfn" href="#credential-store">credential store</a>:</p>

  
    <ol>
    
     <li>
      Set <var>credential</var>’s <code class="idl"><a data-link-type="idl" href="#dom-locallystoredcredential-origin-slot">[[origin]]</a></code> slot to the <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-6.2">ASCII
      serialization</a> of <var>origin</var>.
    
     
    
     <li>
      If <var>credential</var>’s <code class="idl"><a data-link-type="idl" href="#dom-locallystoredcredential-iconurl">iconURL</a></code> is an
      <a data-link-type="dfn" href="https://w3c.github.io/webappsec/specs/mixedcontent/#a-priori-insecure-url"><i lang="la">a priori</i> insecure URL</a>, set <var>credential</var>’s
      <code class="idl"><a data-link-type="idl" href="#dom-locallystoredcredential-iconurl">iconURL</a></code> to the empty string.
    
     
    
     <li>
      Switch on <var>credential</var>’s interface, and execute the associated
      steps:

      
      <dl>
        
       <dt><code class="idl"><a data-link-type="idl" href="#passwordcredential">PasswordCredential</a></code>
       
        
       <dd>
          
        <ol>
            
         <li>
              If the user agent’s credential manager contains a
              <code class="idl"><a data-link-type="idl" href="#passwordcredential">PasswordCredential</a></code> <var>storedCredential</var> whose
              <code class="idl"><a data-link-type="idl" href="#dom-credential-id">id</a></code> attribute is <var>credential</var>’s
              <code class="idl"><a data-link-type="idl" href="#dom-credential-id">id</a></code> and whose <code class="idl"><a data-link-type="idl" href="#dom-locallystoredcredential-origin-slot">[[origin]]</a></code> slot is
              <var>origin</var>, then:

              
          <ol>
                
           <li>
                  If the user grants <var>origin</var> permission to update
                  credentials (as discussed in <a href="#user-mediated-storage">§5.1 Storing and Updating Credentials</a>),
                  then:

                  
            <ol>
                    
             <li>
                      Set <var>storedCredential</var>’s <code class="idl"><a data-link-type="idl" href="#dom-passwordcredential-password-slot">[[password]]</a></code> to the
                      value of <var>credential</var>’s <code class="idl"><a data-link-type="idl" href="#dom-passwordcredential-password-slot">[[password]]</a></code>
                      slot.
                    
             
                    
             <li>
                      Set <var>storedCredential</var>’s
                      <code class="idl"><a data-link-type="idl" href="#dom-locallystoredcredential-name">name</a></code> to the
                      value of <var>credential</var>’s
                      <code class="idl"><a data-link-type="idl" href="#dom-locallystoredcredential-name">name</a></code>.
                    
             
                    
             <li>
                      Set <var>storedCredential</var>’s
                      <code class="idl"><a data-link-type="idl" href="#dom-locallystoredcredential-iconurl">iconURL</a></code> to
                      the value of <var>credential</var>’s
                      <code class="idl"><a data-link-type="idl" href="#dom-locallystoredcredential-iconurl">iconURL</a></code>.
                    
             
                  
            </ol>
            
                
           
              
          </ol>
          
            
         
            
         <li>
              Otherwise:

              
          <ol>
                
           <li>
                  If the user grants <var>origin</var> permission to store
                  credentials (as discussed in <a href="#user-mediated-storage">§5.1 Storing and Updating Credentials</a>), then
                  store <var>credential</var> in the <a data-link-type="dfn" href="#credential-store">credential store</a>.
                
           
              
          </ol>
          
            
         
          
        </ol>
        
        
       

        
       <dt><code class="idl"><a data-link-type="idl" href="#federatedcredential">FederatedCredential</a></code>
       
        
       <dd>
          
        <ol>
            
         <li>
              If the user agent’s credential manager does not contain a
              <code class="idl"><a data-link-type="idl" href="#federatedcredential">FederatedCredential</a></code> <var>storedCredential</var> whose
              <code class="idl"><a data-link-type="idl" href="#dom-credential-id">id</a></code> attribute is <var>credential</var>’s
              <code class="idl"><a data-link-type="idl" href="#dom-credential-id">id</a></code> and whose <code class="idl"><a data-link-type="idl" href="#dom-federatedcredential-provider">provider</a></code>
              attribute is <var>credential</var>’s
              <code class="idl"><a data-link-type="idl" href="#dom-federatedcredential-provider">provider</a></code>, then:

              
          <ol>
                
           <li>
                  If the user grants <var>origin</var> permission to store
                  credentials (as discussed in <a href="#user-mediated-storage">§5.1 Storing and Updating Credentials</a>),
                  store <var>credential</var> in the <a data-link-type="dfn" href="#credential-store">credential store</a>.
                
           
              
          </ol>
          
            
         
          
        </ol>
        
        
       

        
       <dt><em>This is an extension point.</em>
       
        
       <dd>
          When new credential types are defined in the future, they’ll go here.
        
       
      
      </dl>
      
    
     
    
     <li>
      Return <var>credential</var>.
    
     
  
    </ol>

  
    <h4 class="heading settled" data-level="4.2.6" id="require-user-mediation-for-origin"><span class="secno">4.2.6. </span><span class="content">
    Require user mediation for <var>origin</var>
  </span><a class="self-link" href="#require-user-mediation-for-origin"></a></h4>

  
    <ol>
    
     <li>
      Let <var>promise</var> be a newly created <code>Promise</code> object.
    
     
    
     <li>
      Return <var>promise</var>, and execute the remaining steps asynchronously.
    
     
    
     <li>
      Set <var>origin</var>’s <a data-link-type="dfn" href="#requires-user-mediation">requires user mediation</a> flag to
      <code>true</code> in the user agent’s <a data-link-type="dfn" href="#credential-store">credential store</a>.
    
     
    
     <li>
      Resolve <var>promise</var> with <code>undefined</code>.
    
     
  
    </ol>

  
    <h4 class="heading settled" data-level="4.2.7" id="is-match"><span class="secno">4.2.7. </span><span class="content">
    Does <var>credential</var> match <var>origin B</var>?
  </span><a class="self-link" href="#is-match"></a></h4>

  
    <ol>
    
     <li>
      Let <var>origin A</var> be the value of <var>credential</var>’s
      <code class="idl"><a data-link-type="idl" href="#dom-locallystoredcredential-origin-slot">[[origin]]</a></code> slot.
    
     
    
     <li>
      If <var>origin A</var> is <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-5">the same</a> as <var>origin B</var>, return
      <code>Exact Match</code>.
    
     
    
     <li>
      If <var>origin A</var>’s <code class="idl"><a data-link-type="idl" href="http://www.w3.org/TR/url/#concept-url-scheme">scheme</a></code> is <var>origin B</var>’s
      <code class="idl"><a data-link-type="idl" href="http://www.w3.org/TR/url/#concept-url-scheme">scheme</a></code>, and <var>origin A</var>’s <code class="idl"><a data-link-type="idl" href="http://www.w3.org/TR/url/#concept-url-host">host</a></code>'s <a data-link-type="dfn" href="https://publicsuffix.org/list/#">registerable
      domain</a> is <var>origin B</var>’s <code class="idl"><a data-link-type="idl" href="http://www.w3.org/TR/url/#concept-url-host">host</a></code>'s <a data-link-type="dfn" href="https://publicsuffix.org/list/#">registerable
      domain</a>, then return <code>Fuzzy Match</code>.
    
     
    
     <li>
      Return <code>No Match</code>
    
     
  
    </ol>
</section>



   <section>
  
    <h2 class="heading settled" data-level="5" id="user-mediation"><span class="secno">5. </span><span class="content">User Mediation</span><a class="self-link" href="#user-mediation"></a></h2>


    <p>Exposing credential information to the web via an API has a number of
  potential impacts on user privacy. The user agent, therefore, MUST
  involve the user in a number of cases in order to ensure that she clearly
  understands what’s going on, and with whom her credentials are being shared.</p>

  
    <h3 class="heading settled" data-level="5.1" id="user-mediated-storage"><span class="secno">5.1. </span><span class="content">Storing and Updating Credentials</span><a class="self-link" href="#user-mediated-storage"></a></h3>


    <p>Credential information is sensitive data, and users MUST remain in control
  of that information’s storage. Inadvertent credential storage could, for
  instance, unexpectedly link a user’s local profile on a particular device to
  a specific online persona. To mitigate the risk of surprise:</p>

  
    <ol>
    
     <li>
      Credential information MUST NOT be stored or updated without explicit
      user consent. For example, the user agent could display a "Save this
      password?" dialog box to the user in response to each call to
      <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-storecredential">store()</a></code>.
    
     
    
     <li>
      User consent MAY be requested every time a credential is stored or
      updated, <strong>or</strong> the user agent MAY request a more persistent
      grant of consent which would apply to some or all subsequent API
      operations.


      <p>For example, a user agent may offer an option to "Always save passwords",
      or "Always save password on this site".</p>
      
    
     
    
     <li>
      User agents SHOULD notify users when credentials are stored. This might
      take the form of an icon in the address bar, or some similar location.
    
     
    
     <li>
      User agents MUST allow users to manually remove stored credentials. This
      functionality might be implemented as a settings page, or via interaction
      with a notification as described above.
    
     
  
    </ol>

  
    <h3 class="heading settled" data-level="5.2" id="user-mediation-requirements"><span class="secno">5.2. </span><span class="content">Requiring User Mediation</span><a class="self-link" href="#user-mediation-requirements"></a></h3>


    <p>If a an <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a>’s <a data-link-type="dfn" href="#requires-user-mediation">requires user mediation</a> flag is set to
  <code>false</code> in the user agent’s <a data-link-type="dfn" href="#credential-store">credential store</a>, then
  <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> objects from that origin MAY be provided to pages from that
  origin without user interaction. The user will be signed-in to that origin
  persistently, which, on the one hand, is desirable from the perspective of
  usability and convinience, but which might nevertheless surprise the user.</p>


    <p>If the user agent syncs the state of a <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> between devices, an
  origin could explicitly tie the devices together in a way which might surprise
  their owner.</p>


    <p>To mitigate the risk of surprise:</p>

  
    <ol>
    
     <li>
      User agents MUST allow users to require user mediation for <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code>
      objects. This functionality might be implemented as a global toggle that
      requires user mediation for all origins, or via more granular settings
      for specific origins (or specific credentials on specific origins).
    
     
    
     <li>
      User agents MUST NOT set an origin’s <a data-link-type="dfn" href="#requires-user-mediation">requires user mediation</a> slot’s
      value to <code>false</code> without user consent. For example, the
      <a data-link-type="dfn" href="#credential-chooser">credential chooser</a> described in <a href="#user-mediated-selection">§5.3 Credential Selection</a> could
      have a checkbox which the user could toggle to mark the selected
      credential as available without mediation for the origin, or the user
      agent could have an onboarding process for its credential manager which
      asked a user for a default setting.
    
     
    
     <li>
      User agents MUST notify users when credentials are provided to an
      origin. This could take the form of an icon in the address bar, or some
      similar location.
    
     
    
     <li>
      If a user clears her browsing data for an origin (cookies, localStorage,
      and so on), the user agent MUST require user mediation for that origin
      by executing the algorithm defined in
      <a href="#require-user-mediation-for-origin">§4.2.6 
    Require user mediation for origin
  </a>.
    
     
  
    </ol>

  
    <h3 class="heading settled" data-level="5.3" id="user-mediated-selection"><span class="secno">5.3. </span><span class="content">Credential Selection</span><a class="self-link" href="#user-mediated-selection"></a></h3>


    <p>When responding to a call to <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-getrequest">get()</a></code> on an origin without credentials
  that are available without user mediation, user agents MUST ask the user for
  permission to share credential information. This SHOULD take the form of a
  <dfn data-dfn-type="dfn" data-local-lt="chooser" data-noexport="" id="credential-chooser">credential chooser<a class="self-link" href="#credential-chooser"></a></dfn> which presents the user
  with a list of credentials that are available for use on a site, allowing her
  to select one which should be provided to the website, or to reject the
  request entirely.</p>


    <p>The chooser interface SHOULD be implemented in such a way as to be
  distinguishable from UI which a website could produce. For example, the
  chooser might overlap the user agent’s UI in some unspoofable way.</p>


    <p>The chooser interface SHOULD include an indication of the origin which is
  requesting credentials.</p>


    <p>The chooser interface SHOULD include all <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> objects associated
  with the origin that requested credentials. It may also synthesize
  <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> objects to support a sign-up use case, as discussed in
  <a href="#synthesis">§5.3.1 Synthesizing Credentials</a>.</p>


    <p><em>The following image is an exceptionally non-normative mock:</em></p>


    <p><img alt="A mockup of what a chooser might look like." src="./mock-chooser.png"></p>


    <p>User agents MAY internally associate information with each <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code>
  object beyond the attributes specified in this document in order to enhance
  the utility of such a chooser. For example, favicons could help disambiguate
  identity providers, etc. Any additional information stored MUST not be
  exposed directly to the web.</p>

  
    <h4 class="heading settled" data-level="5.3.1" id="synthesis"><span class="secno">5.3.1. </span><span class="content">Synthesizing Credentials</span><a class="self-link" href="#synthesis"></a></h4>


    <p>In response to a call to <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-getrequest">get()</a></code> a user agent can offer a user the ability
  to create a <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> on the fly, rather than returning an empty set.
  Since credentials suggested in the <a data-link-type="dfn" href="#credential-chooser">credential chooser</a> are never exposed
  to the web unless the user explicitly selects them, the user agent is free
  to use any of a number of heuristics to help a user get signed-into/-up for
  a website.</p>


    <p>Credentials SHOULD be synthesized to populate a <a data-link-type="dfn" href="#credential-chooser">chooser</a> based on the
  following heuristics:</p>

  
    <ol>
    
     <li>
      Let <var>synthesized</var> be an empty list.
    
     
    
     <li>
      Switch on the interface whose <code class="idl"><a data-link-type="idl" href="#dom-credential-type">type</a></code> property matches one of
      the items in the <code class="idl"><a data-link-type="idl" href="#dictdef-credentialrequest">CredentialRequest</a></code> <code class="idl"><a data-link-type="idl" href="#dom-credentialrequest-types">types</a></code>
      sequence, and execute the associated steps:

      
      <dl>
        
       <dt><code class="idl"><a data-link-type="idl" href="#federatedcredential">FederatedCredential</a></code>
       
        
       <dd>
          When executing the <a href="#gather-locallystoredcredentials">§4.2.1 
    Gather LocallyStoredCredentials
  </a> algorithm, a
          user agent SHOULD populate the <a data-link-type="dfn" href="#credential-chooser">chooser</a> with options based on
          the following heuristic:

          
        <ol>
            
         <li>
              Let <var>providers</var> be the value of <var>options</var>'
              <var>providers</var> property.
            
         
            
         <li>
              For each <code class="idl"><a data-link-type="idl" href="#passwordcredential">PasswordCredential</a></code> <var>credential</var> in the
              <a data-link-type="dfn" href="#credential-store">credential store</a>:

              
          <ol>
                
           <li>
                  For each <var>provider</var> in <var>options</var>'
                  <code class="idl"><a data-link-type="idl" href="#dom-federatedcredentialrequestoptions-providers">providers</a></code> property:

                  
            <ol>
                    
             <li>
                      If <a href="#is-match">§4.2.7 
    Does credential match origin B?
  </a> returns <code>Exact Match</code> or
                      <code>Fuzzy Match</code> when executed upon
                      <var>credential</var> and <var>provider</var>:

                      
              <ol>
                        
               <li>
                          Create a new <code class="idl"><a data-link-type="idl" href="#federatedcredential">FederatedCredential</a></code> object
                          <var>new</var> whose <code class="idl"><a data-link-type="idl" href="#dom-locallystoredcredential-origin-slot">[[origin]]</a></code> slot is set to
                          <var>origin</var>, <code class="idl"><a data-link-type="idl" href="#dom-credential-id">id</a></code> is set to
                          <var>credential</var>’s <code class="idl"><a data-link-type="idl" href="#dom-credential-id">id</a></code>,
                          <code class="idl"><a data-link-type="idl" href="#dom-federatedcredential-provider">provider</a></code> is set to
                          <var>provider</var>.
                        
               
                        
               <li>
                          Append <var>new</var> to <var>synthesized</var>.
                        
               
                      
              </ol>
              
                    
             
                  
            </ol>
            
                
           
              
          </ol>
          
            
         
          
        </ol>
        
        
       
        
       <dt><em>This is an extension point.</em>
       
        
       <dd>
          When new credential types are defined in the future, they’ll go here.
        
       
      
      </dl>
      
    
     
    
     <li>
      Return <var>synthesized</var>.
    
     
  
    </ol>


    <p>User agents MAY employ additional heuristics (based, for instance, on a user’s
  browsing history, crowdsourcing, etc) to further populate the <a data-link-type="dfn" href="#credential-chooser">chooser</a>.</p>

  
    <div class="example" id="example-abc23ddc"><a class="self-link" href="#example-abc23ddc"></a>
    Assume for a moment that <code>https://example.com/</code> is an amazing new
    website that supports a large number of federated identity providers in an
    effort to make sign-up as seamless as possible for new users. This ends up
    being a bit counterproductive, as the site needs to display a list of dozens
    of providers, hoping that users will see an icon they remember.


     <p>A call to <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-getrequest">get()</a></code> will end up with an empty list of <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> objects
    for new users, as they won’t have any <code>https://example.com/</code>
    credentials. They might, however, have a <code class="idl"><a data-link-type="idl" href="#passwordcredential">PasswordCredential</a></code> stored for
    the exciting social media site <code>https://federation.com/</code>, which
    they visit daily.</p>
     


     <p>In this case, based on its knowledge of the user’s history and credentials,
    the user agent might choose to synthesize a <code class="idl"><a data-link-type="idl" href="#federatedcredential">FederatedCredential</a></code> for
    <code>https://example.com/</code>, using the <code class="idl"><a data-link-type="idl" href="#dom-credential-id">id</a></code> from
    <code>https://federation.com/</code>’s <code class="idl"><a data-link-type="idl" href="#passwordcredential">PasswordCredential</a></code>, and offer
    it to the user as a sign-up options in a <a data-link-type="dfn" href="#credential-chooser">chooser</a>.</p>
     


     <p>In this way, <code>https://example.com/</code> can support dozens of
    providers as arguments to <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-getrequest">get()</a></code> (via
    <code class="idl"><a data-link-type="idl" href="#dictdef-federatedcredentialrequestoptions">FederatedCredentialRequestOptions</a></code>'s
    <code class="idl"><a data-link-type="idl" href="#dom-federatedcredentialrequestoptions-providers">providers</a></code> property), and the user
    agent can cull that list down to the federations with which the user
    regularly interacts (or which have been previously used as
    <code class="idl"><a data-link-type="idl" href="#federatedcredential">FederatedCredential</a></code>s, or any of a number of other heuristics).</p>
     
  
    </div>
</section>



   <section>
  
    <h2 class="heading settled" data-level="6" id="security-considerations"><span class="secno">6. </span><span class="content">Security Considerations</span><a class="self-link" href="#security-considerations"></a></h2>

  
    <h3 class="heading settled" data-level="6.1" id="security-cross-origin-leakage"><span class="secno">6.1. </span><span class="content">Cross-origin Credential Leakage</span><a class="self-link" href="#security-cross-origin-leakage"></a></h3>


    <p>Credentials are sensitive information, and user agents need to exercise
  caution in determining when they can be safely shared with a website. The
  safest option is to restrict credential sharing to the exact origin on
  which they were saved. That is likely too restrictive for the web, however:
  consider sites which divide functionality into subdomains:
  <code>example.com</code> vs <code>admin.example.com</code>.</p>


    <p>As a compromise between annoying users, and securing their credentials, user
  agents:</p>

  
    <ol>
    
     <li>
      MUST NOT share credentials between origins whose scheme components are
      not the same. That is: credentials saved on
      <code>https://example.com/</code> will never be available to
      <code>http://example.com/</code> via <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-getrequest">get()</a></code>
    
     
    
     <li>
      MAY use the Public Suffix List <a data-link-type="biblio" href="#biblio-psl">[PSL]</a> to determine the effective scope
      of a credential by comparing the <a data-link-type="dfn" href="https://publicsuffix.org/list/#">registerable domains</a> of the
      credential’s <code class="idl"><a data-link-type="idl" href="#dom-locallystoredcredential-origin-slot">[[origin]]</a></code> with the origin in which
      <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-getrequest">get()</a></code> is called. That is: credentials saved on
      <code>https://admin.example.com/</code> and
      <code>https://example.com/</code> MAY be offered to users when
      <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-getrequest">get()</a></code> is called from <code>https://www.example.com/</code>
    
     
    
     <li>
      MUST NOT offer credentials to an origin in response to <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-getrequest">get()</a></code>
      without user mediation if the credential’s origin is not an exact match
      for the calling origin. That is, <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> objects for
      <code>https://example.com</code> would not be returned directly to
      <code>https://www.example.com</code>, but could be offered to the user
      via the chooser.
    
     
  
    </ol>


    <p><code class="idl"><a data-link-type="idl" href="#passwordcredential">PasswordCredential</a></code>s further mitigate the risk of data leakage by never
  exposing the <code class="idl"><a data-link-type="idl" href="#dom-passwordcredential-password-slot">[[password]]</a></code> slot directly to a page’s JavaScript, but
  instead performing asynchronous submission via <code class="idl"><a data-link-type="idl" href="#dom-passwordcredential-sendurl">send()</a></code>,
  which verifies that the endpoint is a valid one for the credential before
  submission.</p>


    <p>Additionally, authors SHOULD mitigate the risk of leakage by setting a
  reasonable Content Security Policy <a data-link-type="biblio" href="#biblio-csp2">[CSP2]</a> which restricts the origins to
  which data can be sent. In particular, authors should ensure that the
  following directives are set, explicitly or implicitly, in
  their pages' policies:</p>

  
    <ol>
    
     <li>
      <code><a data-link-type="dfn" href="https://w3c.github.io/webappsec/specs/content-security-policy/#directive-connect-src">connect-src</a></code> further restricts the origins to which
      <code class="idl"><a data-link-type="idl" href="#dom-passwordcredential-sendurl">send()</a></code> may submit data (which mitigates the risk of
      redirect-based attacks.
    
     
    
     <li>
      <code><a data-link-type="dfn" href="https://w3c.github.io/webappsec/specs/content-security-policy/#directive-child-src">child-src</a></code> restricts the nested browsing
      contexts which may be embedded in a page, making it more difficult to
      inject a malicious <code class="idl"><a data-link-type="idl" href="http://www.w3.org/TR/webmessaging/#dom-window-postmessage">postMessage()</a></code> target. <a data-link-type="biblio" href="#biblio-webmessaging">[WEBMESSAGING]</a>
    
     
  
    </ol>

  
    <h3 class="heading settled" data-level="6.2" id="security-origin-confusion"><span class="secno">6.2. </span><span class="content">Origin Confusion</span><a class="self-link" href="#security-origin-confusion"></a></h3>


    <p>If framed pages have access to the APIs defined here, it might be possible
  to confuse a user into granting access to credentials for an origin other
  than the <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context">top-level browsing context</a>, which is the only security origin
  which users can reasonably be expected to understand.</p>


    <p>Therefore, <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#nested-browsing-context">Nested browsing contexts</a> and other environments like
  Workers <a data-link-type="biblio" href="#biblio-workers">[WORKERS]</a> cannot receive or store <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> objects; the user
  agent MUST reject promises generated by calls to <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-getrequest">get()</a></code> and
  <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-storecredential">store()</a></code> with a <code>SecurityError</code> when called from a
  context which is not a <a data-link-type="dfn" href="http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context">top-level browsing context</a>.</p>


    <p>See the algorithms defined in <a href="#request-credential">§4.1.1 
    Request a Credential
  </a> and <a href="#store-credential">§4.1.2 
    Store a Credential
  </a>
  for details.</p>

  
    <h3 class="heading settled" data-level="6.3" id="security-insecure-origins"><span class="secno">6.3. </span><span class="content">Insecure Sites</span><a class="self-link" href="#security-insecure-origins"></a></h3>


    <p>User agents MUST NOT expose credential information via the APIs defined here
  to environments which are not <a data-link-type="dfn" href="https://w3c.github.io/webappsec/specs/powerfulfeatures/#privileged-context">privileged contexts</a>. User agents MAY
  implement autofill mechanisms which store user credentials and fill sign-in
  forms on <a data-link-type="dfn" href="https://w3c.github.io/webappsec/specs/mixedcontent/#a-priori-insecure-origin"><i lang="la">a priori</i> insecure origins</a>, but those
  sites cannot be trusted to interact directly with the credential manager in
  any meaningful way.</p>

  
    <h3 class="heading settled" data-level="6.4" id="security-xss"><span class="secno">6.4. </span><span class="content">Script Injection</span><a class="self-link" href="#security-xss"></a></h3>


    <p>If a malicious party is able to inject script into an origin, they could
  (among many other things you wouldn’t like) overwrite the behavior of
  <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-storecredential">store()</a></code> to steal a user’s credentials as they’re written into the
  <a data-link-type="dfn" href="#credential-store">credential store</a>.</p>


    <p>Authors SHOULD mititgate the risk of such attacks by properly escaping input
  and output, and add layers of defense in depth by setting a reasonably
  strong Content Security Policy <a data-link-type="biblio" href="#biblio-csp2">[CSP2]</a> which restricts the origins from
  which script can be injected, and by using Subresource Integrity checks
  <a data-link-type="biblio" href="#biblio-sri">[SRI]</a> to ensure that only trusted JavaScript is executed.</p>

  
    <h3 class="heading settled" data-level="6.5" id="security-autocomplete-off"><span class="secno">6.5. </span><span class="content">
    Avoid reintroducing <code>autocomplete="off"</code>
  </span><a class="self-link" href="#security-autocomplete-off"></a></h3>


    <p>Some user agents have decided not to implement the
  <a data-link-type="element-attr" href="http://www.w3.org/TR/html5/forms.html#attr-form-autocomplete">autocomplete</a> attribute in such a way as to
  prevent users from saving credentials. The APIs defined here SHOULD be
  implemented such that they don’t provide an automatic way of bypassing that
  decision. Some of the requirements in <a href="#user-mediated-storage">§5.1 Storing and Updating Credentials</a> are in place
  for exactly this reason.</p>
</section>


   <section>
  
    <h2 class="heading settled" data-level="7" id="privacy-considerations"><span class="secno">7. </span><span class="content">Privacy Considerations</span><a class="self-link" href="#privacy-considerations"></a></h2>

  
    <h3 class="heading settled" data-level="7.1" id="privacy-timing-attacks"><span class="secno">7.1. </span><span class="content">Timing Attacks</span><a class="self-link" href="#privacy-timing-attacks"></a></h3>


    <p>If the user has no credentials for an origin, a call to <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-getrequest">get()</a></code> will
  resolve very quickly indeed. A malicious website could distinguish between
  a user with no credentials and a user with credentials who chooses not to
  share them.</p>


    <p>This could allow a malicious website to determine if a user has credentials
  saved for particular federated identity providers by repeatedly calling
  <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-getrequest">get()</a></code> with a single item in the
  <code class="idl"><a data-link-type="idl" href="#dom-federatedcredentialrequestoptions-providers">providers</a></code> array. The risk is mitigated
  by the fact that a user-mediated <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-getrequest">get()</a></code> is tied to a user gesture, and the
  user would, sooner or later, be prompted to provide credentials to the site,
  which would certainly raise her suspicions as to its behavior.</p>

  
    <h3 class="heading settled" data-level="7.2" id="privacy-chooser-leakage"><span class="secno">7.2. </span><span class="content">Chooser Leakage</span><a class="self-link" href="#privacy-chooser-leakage"></a></h3>


    <p>If a user agent displays images supplied by a website or federation (for
  example, if a <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code>'s <code class="idl"><a data-link-type="idl" href="#dom-locallystoredcredential-iconurl">iconURL</a></code> is displayed),
  requests for these images MUST NOT be directly tied to instantiating the
  chooser in order to avoid leaking chooser usage. One option would be to fetch
  the images in the background when saving or updating a <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code>, and to
  cache them for the lifetime of the <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code>.</p>


    <p>Further, these images MUST be fetched with the <code>credentials</code> mode
  set to "<code>omit</code>".</p>

  
    <h3 class="heading settled" data-level="7.3" id="locally-stored-data"><span class="secno">7.3. </span><span class="content">Locally Stored Data</span><a class="self-link" href="#locally-stored-data"></a></h3>


    <p>This API offers an <a data-link-type="dfn" href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a> the ability to store data persistently along
  with a user’s profile. Since most user agents treat credential data
  differently than "browsing data" (cookies, etc.) this might have the side
  effect of surprising a user who might believe that all traces of an origin
  have been wiped out when they clear their cookies.</p>


    <p>User agents SHOULD provide UI that makes it clear to a user that credential
  data is stored for an origin, and SHOULD make it easy for users to remove
  such data when they’re no longer interested in keeping it around.</p>
</section>



   <section>
  
    <h2 class="heading settled" data-level="8" id="implementation-considerations"><span class="secno">8. </span><span class="content">Implementation Considerations</span><a class="self-link" href="#implementation-considerations"></a></h2>

  
    <h3 class="heading settled" data-level="8.1" id="implementation-for-authors"><span class="secno">8.1. </span><span class="content">Website Authors</span><a class="self-link" href="#implementation-for-authors"></a></h3>


    <p><em>This section is non-normative.</em></p>


    <p class="issue" id="issue-0bebb85f"><a class="self-link" href="#issue-0bebb85f"></a>Add some thoughts here about when and how the API
  should be used, especially with regard to <code class="idl"><a data-link-type="idl" href="#dom-credentialrequest-suppressui">suppressUI</a></code>. <a href="https://github.com/w3c/webappsec/issues/290">&lt;https://github.com/w3c/webappsec/issues/290></a></p>

  
    <h3 class="heading settled" data-level="8.2" id="implementation-extension"><span class="secno">8.2. </span><span class="content">Extension Points</span><a class="self-link" href="#implementation-extension"></a></h3>


    <p>As noted in <a href="#future-work">§9 Future Work</a>, there is known interest in extending the API
  defined here to serve use cases beyond those this document addresses. To
  that end, the API is fairly generic, with several explicit extension points.</p>

  
    <div class="example" id="example-c326fd5b"><a class="self-link" href="#example-c326fd5b"></a>
    If we wished to add a new credential type, how would we spell it out?

    
     <ol>
      
      <li>
        Define a new <code>ExampleCredential</code> that inherits from
        <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code>:

        
       <pre>interface ExampleCredential : Credential {
  // Definition goes here.
};
</pre>
       
      
      
      
      <li>
        Define the options that the new credential type requires, and add them
        to the <code class="idl"><a data-link-type="idl" href="#typedefdef-credentialrequestoptions">CredentialRequestOptions</a></code> typedef:

        
       <pre>dictionary ExampleCredentialRequestOptions {
  // Definition goes here.
};

typedef (FederatedCredentialRequestOptions or ExampleCredentialRequestOptions) CredentialRequestOptions;
</pre>
       
      
      
      
      <li>
        Add <code>ExampleCredential</code> to the switch in step 8 of
        <a href="#request-credential">§4.1.1 
    Request a Credential
  </a>, and define the request behavior necessary to
        grab and return the new type.
      
      
      
      <li>
        Add <code>ExampleCredential</code> to the switch in step 6 of
        <a href="#store-credential">§4.1.2 
    Store a Credential
  </a>, and define the persistance behavior necessary to
        store the new type.
      
      
    
     </ol>
     
  
    </div>


    <p>You might also need new primitives. For instance, you might want to return
  many <code class="idl"><a data-link-type="idl" href="#credential">Credential</a></code> objects rather than just one. That might be accomplished
  in a generic fashion by adding a <code>getAll()</code> method to
  <code class="idl"><a data-link-type="idl" href="#credentialcontainer">CredentialContainer</a></code>, and defining a <code>CredentialSet</code> object that
  contained a <code>sequence&lt;Credential></code>, and could be easily
  extended to meet some use case.</p>


    <p>For any such extension, we recommend getting in touch with
  <a href="mailto:public-webappsec@w3.org">public-webappsec@</a> for
  consultation and review.</p>

  
    <h3 class="heading settled" data-level="8.3" id="implementation-browser-extensions"><span class="secno">8.3. </span><span class="content">Browser Extensions</span><a class="self-link" href="#implementation-browser-extensions"></a></h3>


    <p>Ideally, user agents that implement an extension system of some sort will
  allow third-parties to hook into these API endpoints in order to improve
  the behavior of third party credential management software in the same way
  that user agents can improve their own via this imperative approach.</p>


    <p>This could range from a complex new API that the user agent mediates, or
  simply by allowing extensions to overwrite the <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-getrequest">get()</a></code> and <code class="idl"><a data-link-type="idl" href="#dom-credentialcontainer-storecredential">store()</a></code>
  endpoints for their own purposes.</p>
</section>



   <section>
  
    <h2 class="heading settled" data-level="9" id="future-work"><span class="secno">9. </span><span class="content">Future Work</span><a class="self-link" href="#future-work"></a></h2>


    <p><em>This section is non-normative.</em></p>


    <p>The API defined here does the bare minimum to expose user agent’s credential
  managers to the web, and allows the web to help those credential managers
  understand when <a data-link-type="dfn" href="#federated-identity-provider">federated identity providers</a> are in use. The next
  logical step will be along the lines sketched in documents like <a data-link-type="biblio" href="#biblio-web-login">[WEB-LOGIN]</a>
  (and, to some extent, Mozilla’s BrowserID <a data-link-type="biblio" href="#biblio-browserid">[BROWSERID]</a>).</p>


    <p>The user agent is in the unique position of being able to effectively mediate
  the relationship between users, identity providers, and websites. If the user
  agent can remove some of the risk and confusion associated with the typical
  authentication flows, users will be in a significantly better position than
  today.</p>


    <p>The natural way to expose this information is to extend the
  <code class="idl"><a data-link-type="idl" href="#federatedcredential">FederatedCredential</a></code> interface with properties like authentication tokens,
  and to add some form of manifest format with properties that declare the
  authentication type which the provider supports.</p>


    <p>Baby steps.</p>

  
    <div class="issue" id="issue-9c0b1540"><a class="self-link" href="#issue-9c0b1540"></a>
    Groups like the
    <a href="http://www.w3.org/Payments/IG/">Web Payments IG</a>
    and the
    <a href="https://www.w3.org/community/credentials/">Credentials CG</a>
    have expressed interest in extending the API defined in this document in
    order to address use cases beyond those outlined in <a href="#use-cases">§1.1 Use Cases</a>. They’ve
    documented these use cases in detail in
    <a href="http://www.w3.org/TR/web-payments-use-cases/">Web Payments Use Cases 1.0</a>
    and
    <a href="http://opencreds.org/specs/source/use-cases/">Credentials CG Use Cases</a>,
    and anticipate extending the API in a separate document to solve a different
    set of problems than WebAppSec is currently chartered to deal with.  We
    should keep track of this work as it progresses and make appropriate
    references to any technical reports which may assist in understanding and
    implementing this report, as appropriate, when this document is ready to
    transition to Recommendation status.


     <p>It’s not yet clear whether the API proposed in this document allows these
    and other groups to elegantly address the problems they’re interested in
    solving. We may wish to adjust portions of the API before advancing this
    document to REC in order to ensure clean extensibility into these other
    areas.</p>
     
  
    </div>
</section>

</main>

  <h2 class="no-ref no-num heading settled" id="conformance"><span class="content">Conformance</span><a class="self-link" href="#conformance"></a></h2>


  <h3 class="no-ref no-num heading settled" id="conventions"><span class="content">Document conventions</span><a class="self-link" href="#conventions"></a></h3>

    
  <p>Conformance requirements are expressed with a combination of
    descriptive assertions and RFC 2119 terminology. The key words "MUST",
    "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT",
    "RECOMMENDED", "MAY", and "OPTIONAL" in the normative parts of this
    document are to be interpreted as described in RFC 2119.
    However, for readability, these words do not appear in all uppercase
    letters in this specification.

    </p>
  <p>All of the text of this specification is normative except sections
    explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119">[RFC2119]</a></p>

    
  <p>Examples in this specification are introduced with the words "for example"
    or are set apart from the normative text with <code>class="example"</code>,
    like this:

    </p>
  <div class="example" id="example-f839f6c8"><a class="self-link" href="#example-f839f6c8"></a>
        
   <p>This is an example of an informative example.</p>
   
    
  </div>

    
  <p>Informative notes begin with the word "Note" and are set apart from the
    normative text with <code>class="note"</code>, like this:

    </p>
  <p class="note" role="note">Note, this is an informative note.</p>


  <h3 class="no-ref no-num heading settled" id="conformant-algorithms"><span class="content">Conformant Algorithms</span><a class="self-link" href="#conformant-algorithms"></a></h3>

    
  <p>Requirements phrased in the imperative as part of algorithms (such as
    "strip any leading space characters" or "return false and abort these
    steps") are to be interpreted with the meaning of the key word ("must",
    "should", "may", etc) used in introducing the algorithm.</p>

    
  <p>Conformance requirements phrased as algorithms or specific steps can be
    implemented in any manner, so long as the end result is equivalent. In
    particular, the algorithms defined in this specification are intended to
    be easy to understand and are not intended to be performant. Implementers
    are encouraged to optimize.</p>


  <h3 class="no-ref no-num heading settled" id="conformance-classes"><span class="content">Conformance Classes</span><a class="self-link" href="#conformance-classes"></a></h3>

    
  <p>A <dfn data-dfn-type="dfn" data-noexport="" id="conformant-user-agent">conformant user agent<a class="self-link" href="#conformant-user-agent"></a></dfn> must implement all the requirements
    listed in this specification that are applicable to user agents.</p>

    
  <p>A <dfn data-dfn-type="dfn" data-noexport="" id="conformant-server">conformant server<a class="self-link" href="#conformant-server"></a></dfn> must implement all the requirements listed
    in this specification that are applicable to servers.</p>




  <h2 class="no-num heading settled" id="index"><span class="content">Index</span><a class="self-link" href="#index"></a></h2>
  <h3 class="no-num heading settled" id="index-defined-here"><span class="content">Terms defined by this specification</span><a class="self-link" href="#index-defined-here"></a></h3>
  <ul class="indexlist">
   <li>chooser, <a href="#credential-chooser">5.3</a>
   <li>conformant server, <a href="#conformant-server">Unnumbered section</a>
   <li>conformant user agent, <a href="#conformant-user-agent">Unnumbered section</a>
   <li>Credential, <a href="#credential">3.1.1</a>
   <li>credential, <a href="#dom-credentialcontainer-storecredential-credential">3.2</a>
   <li>credential chooser, <a href="#credential-chooser">5.3</a>
   <li>CredentialContainer, <a href="#credentialcontainer">3.2</a>
   <li>CredentialData, <a href="#dictdef-credentialdata">3.1.1</a>
   <li>CredentialRequest, <a href="#dictdef-credentialrequest">3.2.1</a>
   <li>CredentialRequestOptions, <a href="#typedefdef-credentialrequestoptions">3.2.1</a>
   <li>Credentials, <a href="#credentials">2</a>
   <li>credentials, <a href="#dom-navigator-credentials">3.2</a>
   <li>Credential Store, <a href="#credential-store">2</a>
   <li>data
    <ul>
     <li>argument for PasswordCredential/PasswordCredential(data), <a href="#dom-passwordcredential-passwordcredentialdata-data">3.1.2</a>
     <li>argument for FederatedCredential/FederatedCredential(data), <a href="#dom-federatedcredential-federatedcredentialdata-data">3.1.3</a>
    </ul>
   <li>FederatedCredential, <a href="#federatedcredential">3.1.3</a>
   <li>FederatedCredential(data), <a href="#dom-federatedcredential-federatedcredentialdata">3.1.3</a>
   <li>FederatedCredentialData, <a href="#dictdef-federatedcredentialdata">3.1.3</a>
   <li>FederatedCredentialRequestOptions, <a href="#dictdef-federatedcredentialrequestoptions">3.2.1</a>
   <li>Federated Credentials, <a href="#federated-credentials">2</a>
   <li>Federated Identity Provider, <a href="#federated-identity-provider">2</a>
   <li>get(), <a href="#dom-credentialcontainer-getrequest">3.2</a>
   <li>get(request), <a href="#dom-credentialcontainer-getrequest">3.2</a>
   <li>iconURL
    <ul>
     <li>dict-member for CredentialData, <a href="#dom-credentialdata-iconurl">3.1.1</a>
     <li>attribute for LocallyStoredCredential, <a href="#dom-locallystoredcredential-iconurl">3.1.1</a>
    </ul>
   <li>id
    <ul>
     <li>dict-member for CredentialData, <a href="#dom-credentialdata-id">3.1.1</a>
     <li>attribute for Credential, <a href="#dom-credential-id">3.1.1</a>
    </ul>
   <li>identity provider, <a href="#federated-identity-provider">2</a>
   <li>IDP, <a href="#federated-identity-provider">2</a>
   <li>LocallyStoredCredential, <a href="#locallystoredcredential">3.1.1</a>
   <li>name
    <ul>
     <li>dict-member for CredentialData, <a href="#dom-credentialdata-name">3.1.1</a>
     <li>attribute for LocallyStoredCredential, <a href="#dom-locallystoredcredential-name">3.1.1</a>
    </ul>
   <li>options, <a href="#dom-credentialrequest-options">3.2.1</a>
   <li>options matching
  algorithm, <a href="#options-matching-algorithm">3.1.1</a>
   <li>[[origin]], <a href="#dom-locallystoredcredential-origin-slot">3.1.1</a>
   <li>[[password]], <a href="#dom-passwordcredential-password-slot">3.1.2</a>
   <li>password, <a href="#dom-passwordcredentialdata-password">3.1.2</a>
   <li>PasswordCredential, <a href="#passwordcredential">3.1.2</a>
   <li>PasswordCredential(data), <a href="#dom-passwordcredential-passwordcredentialdata">3.1.2</a>
   <li>PasswordCredentialData, <a href="#dictdef-passwordcredentialdata">3.1.2</a>
   <li>Password Credentials, <a href="#password-credentials">2</a>
   <li>protocol
    <ul>
     <li>dict-member for FederatedCredentialData, <a href="#dom-federatedcredentialdata-protocol">3.1.3</a>
     <li>attribute for FederatedCredential, <a href="#dom-federatedcredential-protocol">3.1.3</a>
    </ul>
   <li>protocols, <a href="#dom-federatedcredentialrequestoptions-protocols">3.2.1</a>
   <li>provider
    <ul>
     <li>dict-member for FederatedCredentialData, <a href="#dom-federatedcredentialdata-provider">3.1.3</a>
     <li>attribute for FederatedCredential, <a href="#dom-federatedcredential-provider">3.1.3</a>
    </ul>
   <li>providers, <a href="#dom-federatedcredentialrequestoptions-providers">3.2.1</a>
   <li>request, <a href="#dom-credentialcontainer-getrequest-request">3.2</a>
   <li>requires user mediation, <a href="#requires-user-mediation">2</a>
   <li>requireUserMediation(), <a href="#dom-credentialcontainer-requireusermediation">3.2</a>
   <li>send(url), <a href="#dom-passwordcredential-sendurl">3.1.2</a>
   <li>store(), <a href="#dom-credentialcontainer-storecredential">3.2</a>
   <li>store(credential), <a href="#dom-credentialcontainer-storecredential">3.2</a>
   <li>suppressUI, <a href="#dom-credentialrequest-suppressui">3.2.1</a>
   <li>type, <a href="#dom-credential-type">3.1.1</a>
   <li>[[type]], <a href="#dom-credential-type-slot">3.1.1</a>
   <li>types, <a href="#dom-credentialrequest-types">3.2.1</a>
   <li>url, <a href="#dom-passwordcredential-sendurl-url">3.1.2</a></ul>
  <h3 class="no-num heading settled" id="index-defined-elsewhere"><span class="content">Terms defined by reference</span><a class="self-link" href="#index-defined-elsewhere"></a></h3>
  <ul class="indexlist">
   <li><a data-link-type="biblio" href="#biblio-csp2">[CSP2]</a> defines the following terms:
    <ul>
     <li><a href="https://w3c.github.io/webappsec/specs/content-security-policy/#directive-child-src">child-src</a>
     <li><a href="https://w3c.github.io/webappsec/specs/content-security-policy/#directive-connect-src">connect-src</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-fetch">[FETCH]</a> defines the following terms:
    <ul>
     <li><a href="https://fetch.spec.whatwg.org/#requestinit">RequestInit</a>
     <li><a href="https://fetch.spec.whatwg.org/#response">Response</a>
     <li><a href="https://fetch.spec.whatwg.org/#dom-global-fetch">fetch()</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-html5">[html5]</a> defines the following terms:
    <ul>
     <li><a href="http://www.w3.org/TR/html5/webappapis.html#navigator">Navigator</a>
     <li><a href="http://www.w3.org/TR/html5/infrastructure.html#transferable">Transferable</a>
     <li><a href="http://www.w3.org/TR/html5/browsers.html#active-document">active document</a>
     <li><a href="http://www.w3.org/TR/html5/browsers.html#allowed-to-show-a-popup">allowed to show a popup</a>
     <li><a href="http://www.w3.org/TR/html5/forms.html#attr-form-autocomplete">autocomplete</a>
     <li><a href="http://www.w3.org/TR/html5/webappapis.html#incumbent-settings-object">incumbent settings object</a>
     <li><a href="http://www.w3.org/TR/html5/browsers.html#nested-browsing-context">nested browsing context</a>
     <li><a href="http://www.w3.org/TR/html5/webappapis.html#responsible-browsing-context">responsible browsing context</a>
     <li><a href="http://www.w3.org/TR/html5/webappapis.html#responsible-document">responsible document</a>
     <li><a href="http://www.w3.org/TR/html5/infrastructure.html#structured-clone">structured clone</a>
     <li><a href="http://www.w3.org/TR/html5/browsers.html#top-level-browsing-context">top-level browsing context</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-mix">[MIX]</a> defines the following terms:
    <ul>
     <li><a href="https://w3c.github.io/webappsec/specs/mixedcontent/#a-priori-insecure-origin">a priori insecure origin</a>
     <li><a href="https://w3c.github.io/webappsec/specs/mixedcontent/#a-priori-insecure-url">a priori insecure url</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-power">[POWER]</a> defines the following terms:
    <ul>
     <li><a href="https://w3c.github.io/webappsec/specs/powerfulfeatures/#privileged-context">privileged context</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-psl">[PSL]</a> defines the following terms:
    <ul>
     <li><a href="https://publicsuffix.org/list/#">registerable domain</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-rfc6454">[RFC6454]</a> defines the following terms:
    <ul>
     <li><a href="https://tools.ietf.org/html/rfc6454#section-6.2">ascii serialization</a>
     <li><a href="https://tools.ietf.org/html/rfc6454#section-3.2">origin</a>
     <li><a href="https://tools.ietf.org/html/rfc6454#section-5">the same</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-url">[URL]</a> defines the following terms:
    <ul>
     <li><a href="http://www.w3.org/TR/url/#dom-url">URL</a>
     <li><a href="http://www.w3.org/TR/url/#concept-url-host">host</a>
     <li><a href="http://www.w3.org/TR/url/#concept-url-origin">origin</a>
     <li><a href="http://www.w3.org/TR/url/#concept-url-scheme">scheme</a>
     <li><a href="http://www.w3.org/TR/url/#concept-url-parser">url parser</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-webmessaging">[webmessaging]</a> defines the following terms:
    <ul>
     <li><a href="http://www.w3.org/TR/webmessaging/#dom-window-postmessage">postMessage()</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-webidl">[WebIDL]</a> defines the following terms:
    <ul>
     <li><a href="https://heycam.github.io/webidl/#idl-DOMString">DOMString</a>
     <li><a href="https://heycam.github.io/webidl/#idl-USVString">USVString</a>
     <li><a href="https://heycam.github.io/webidl/#idl-boolean">boolean</a>
    </ul>
   <li><a data-link-type="biblio" href="#biblio-xhr">[XHR]</a> defines the following terms:
    <ul>
     <li><a href="https://xhr.spec.whatwg.org/#interface-formdata">FormData</a>
     <li><a href="https://xhr.spec.whatwg.org/#interface-xmlhttprequest">XMLHttpRequest</a>
     <li><a href="https://xhr.spec.whatwg.org/#dom-formdata-append">append()</a>
    </ul></ul>
  <h2 class="no-num heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num heading settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-csp2"><a class="self-link" href="#biblio-csp2"></a>[CSP2]
   <dd>Mike West; Adam Barth; Dan Veditz. <a href="https://w3c.github.io/webappsec/specs/content-security-policy/">Content Security Policy Level 2</a>. CR. URL: <a href="https://w3c.github.io/webappsec/specs/content-security-policy/">https://w3c.github.io/webappsec/specs/content-security-policy/</a>
   <dt id="biblio-fetch"><a class="self-link" href="#biblio-fetch"></a>[FETCH]
   <dd>Anne van Kesteren. <a href="https://fetch.spec.whatwg.org/">Fetch</a>. Living Standard. URL: <a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a>
   <dt id="biblio-mix"><a class="self-link" href="#biblio-mix"></a>[MIX]
   <dd>Mike West. <a href="https://w3c.github.io/webappsec/specs/mixedcontent/">Mixed Content</a>. LCWD. URL: <a href="https://w3c.github.io/webappsec/specs/mixedcontent/">https://w3c.github.io/webappsec/specs/mixedcontent/</a>
   <dt id="biblio-power"><a class="self-link" href="#biblio-power"></a>[POWER]
   <dd>Mike West. <a href="https://w3c.github.io/webappsec/specs/powerfulfeatures/">Requirements for Powerful Features</a>. ED. URL: <a href="https://w3c.github.io/webappsec/specs/powerfulfeatures/">https://w3c.github.io/webappsec/specs/powerfulfeatures/</a>
   <dt id="biblio-psl"><a class="self-link" href="#biblio-psl"></a>[PSL]
   <dd>Mozilla Foundation. <a href="https://publicsuffix.org/">Public Suffix List</a>. URL: <a href="https://publicsuffix.org/">https://publicsuffix.org/</a>
   <dt id="biblio-rfc6454"><a class="self-link" href="#biblio-rfc6454"></a>[RFC6454]
   <dd>Adam Barth. <a href="http://www.ietf.org/rfc/rfc6454.txt">The Web Origin Concept</a>. RFC. URL: <a href="http://www.ietf.org/rfc/rfc6454.txt">http://www.ietf.org/rfc/rfc6454.txt</a>
   <dt id="biblio-url"><a class="self-link" href="#biblio-url"></a>[URL]
   <dd>Anne van Kesteren. <a href="https://url.spec.whatwg.org/">URL</a>. Living Standard. URL: <a href="https://url.spec.whatwg.org/">https://url.spec.whatwg.org/</a>
   <dt id="biblio-webidl"><a class="self-link" href="#biblio-webidl"></a>[WebIDL]
   <dd>Cameron McCormack. <a href="http://www.w3.org/TR/WebIDL/">Web IDL</a>. 19 April 2012. CR. URL: <a href="http://www.w3.org/TR/WebIDL/">http://www.w3.org/TR/WebIDL/</a>
   <dt id="biblio-xhr"><a class="self-link" href="#biblio-xhr"></a>[XHR]
   <dd>Anne van Kesteren. <a href="https://xhr.spec.whatwg.org/">XMLHttpRequest</a>. Living Standard . URL: <a href="https://xhr.spec.whatwg.org/">https://xhr.spec.whatwg.org/</a>
   <dt id="biblio-html5"><a class="self-link" href="#biblio-html5"></a>[HTML5]
   <dd>Robin Berjon; et al. <a href="http://www.w3.org/TR/html5/">HTML5</a>. 28 October 2014. REC. URL: <a href="http://www.w3.org/TR/html5/">http://www.w3.org/TR/html5/</a>
   <dt id="biblio-rfc2119"><a class="self-link" href="#biblio-rfc2119"></a>[RFC2119]
   <dd>S. Bradner. <a href="http://www.ietf.org/rfc/rfc2119.txt">Key words for use in RFCs to Indicate Requirement Levels</a>. March 1997. Best Current Practice. URL: <a href="http://www.ietf.org/rfc/rfc2119.txt">http://www.ietf.org/rfc/rfc2119.txt</a>
   <dt id="biblio-webmessaging"><a class="self-link" href="#biblio-webmessaging"></a>[WEBMESSAGING]
   <dd>Ian Hickson. <a href="http://www.w3.org/TR/webmessaging/">HTML5 Web Messaging</a>. 1 May 2012. CR. URL: <a href="http://www.w3.org/TR/webmessaging/">http://www.w3.org/TR/webmessaging/</a></dl>
  <h3 class="no-num heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-browserid"><a class="self-link" href="#biblio-browserid"></a>[BROWSERID]
   <dd>Ben Adida; et al. <a href="https://github.com/mozilla/id-specs/blob/prod/browserid/index.md">BrowserID</a>. URL: <a href="https://github.com/mozilla/id-specs/blob/prod/browserid/index.md">https://github.com/mozilla/id-specs/blob/prod/browserid/index.md</a>
   <dt id="biblio-manifest"><a class="self-link" href="#biblio-manifest"></a>[MANIFEST]
   <dd>Marcos Caceres; Anssi Kostiainen; Kenneth Rohde Christiansen; et al. <a href="http://w3c.github.io/manifest/">Manifest for web application</a>. WD. URL: <a href="http://w3c.github.io/manifest/">http://w3c.github.io/manifest/</a>
   <dt id="biblio-rfc6749"><a class="self-link" href="#biblio-rfc6749"></a>[RFC6749]
   <dd>Dick Hardt; et al. <a href="http://www.ietf.org/rfc/rfc6749.txt">The OAuth 2.0 Authorization Framework</a>. RFC. URL: <a href="http://www.ietf.org/rfc/rfc6749.txt">http://www.ietf.org/rfc/rfc6749.txt</a>
   <dt id="biblio-sri"><a class="self-link" href="#biblio-sri"></a>[SRI]
   <dd>Frederik Braun; et al. <a href="http://www.w3.org/TR/SRI/">Subresource Integrity</a>. 18 March 2014. WD. URL: <a href="http://www.w3.org/TR/SRI/">http://www.w3.org/TR/SRI/</a>
   <dt id="biblio-web-login"><a class="self-link" href="#biblio-web-login"></a>[WEB-LOGIN]
   <dd>Jason Denizac; Robin Berjon; Anne van Kesteren. <a href="https://github.com/jden/web-login">web-login</a>. URL: <a href="https://github.com/jden/web-login">https://github.com/jden/web-login</a>
   <dt id="biblio-xmlhttprequest"><a class="self-link" href="#biblio-xmlhttprequest"></a>[XMLHttpRequest]
   <dd>Anne van Kesteren; et al. <a href="http://www.w3.org/TR/XMLHttpRequest/">XMLHttpRequest Level 1</a>. 30 January 2014. WD. URL: <a href="http://www.w3.org/TR/XMLHttpRequest/">http://www.w3.org/TR/XMLHttpRequest/</a>
   <dt id="biblio-workers"><a class="self-link" href="#biblio-workers"></a>[WORKERS]
   <dd>Ian Hickson. <a href="http://www.w3.org/TR/workers/">Web Workers</a>. 1 May 2012. CR. URL: <a href="http://www.w3.org/TR/workers/">http://www.w3.org/TR/workers/</a></dl>
  <h2 class="no-num heading settled" id="idl-index"><span class="content">IDL Index</span><a class="self-link" href="#idl-index"></a></h2>
  <pre class="idl">dictionary <a data-global-name="" href="#dictdef-credentialdata">CredentialData</a> {
  DOMString <a data-global-name="CredentialData<dictionary>/id<dict-member>" data-type="DOMString " href="#dom-credentialdata-id">id</a>;
  DOMString <a data-global-name="CredentialData<dictionary>/name<dict-member>" data-type="DOMString " href="#dom-credentialdata-name">name</a>;
  USVString <a data-global-name="CredentialData<dictionary>/iconURL<dict-member>" data-type="USVString " href="#dom-credentialdata-iconurl">iconURL</a>;
};

[NoInterfaceObject]
interface <a data-global-name="" href="#credential">Credential</a> {
  readonly attribute DOMString <a class="idl-code" data-global-name="Credential<interface>/id<attribute>" data-link-type="attribute" data-readonly="" data-type="DOMString " href="#dom-credential-id">id</a>;
  readonly attribute DOMString <a class="idl-code" data-global-name="Credential<interface>/type<attribute>" data-link-type="attribute" data-readonly="" data-type="DOMString " href="#dom-credential-type">type</a>;
};
<a data-link-type="idl-name" href="#credential">Credential</a> implements <a data-link-type="idl-name" href="http://www.w3.org/TR/html5/infrastructure.html#transferable">Transferable</a>;

[NoInterfaceObject]
interface <a data-global-name="" href="#locallystoredcredential">LocallyStoredCredential</a> {
  readonly attribute DOMString <a class="idl-code" data-global-name="LocallyStoredCredential<interface>/name<attribute>" data-link-type="attribute" data-readonly="" data-type="DOMString " href="#dom-locallystoredcredential-name">name</a>;
  readonly attribute USVString <a class="idl-code" data-global-name="LocallyStoredCredential<interface>/iconURL<attribute>" data-link-type="attribute" data-readonly="" data-type="USVString " href="#dom-locallystoredcredential-iconurl">iconURL</a>;
};
<a data-link-type="idl-name" href="#locallystoredcredential">LocallyStoredCredential</a> implements <a data-link-type="idl-name" href="#credential">Credential</a>;

dictionary <a data-global-name="" href="#dictdef-passwordcredentialdata">PasswordCredentialData</a> : <a data-link-type="idl-name" href="#dictdef-credentialdata">CredentialData</a> {
  DOMString <a data-global-name="PasswordCredentialData<dictionary>/password<dict-member>" data-type="DOMString " href="#dom-passwordcredentialdata-password">password</a>;
};

[<a data-global-name="PasswordCredential<interface>/PasswordCredential(data)<constructor>" href="#dom-passwordcredential-passwordcredentialdata">Constructor</a>(<a data-link-type="idl-name" href="#dictdef-passwordcredentialdata">PasswordCredentialData</a> <a data-global-name="PasswordCredential<interface>/PasswordCredential(data)<method>/data<argument>" href="#dom-passwordcredential-passwordcredentialdata-data">data</a>), Exposed=Window]
interface <a data-global-name="" href="#passwordcredential">PasswordCredential</a> {
  Promise&lt;<a data-link-type="idl-name" href="https://fetch.spec.whatwg.org/#response">Response</a>> <a class="idl-code" data-global-name="PasswordCredential<interface>/send(url)<method>" data-link-type="method" href="#dom-passwordcredential-sendurl">send</a>(USVString <a data-global-name="PasswordCredential<interface>/send(url)<method>/url<argument>" href="#dom-passwordcredential-sendurl-url">url</a>);
};
<a data-link-type="idl-name" href="#passwordcredential">PasswordCredential</a> implements <a data-link-type="idl-name" href="#locallystoredcredential">LocallyStoredCredential</a>;

dictionary <a data-global-name="" href="#dictdef-federatedcredentialdata">FederatedCredentialData</a> : <a data-link-type="idl-name" href="#dictdef-credentialdata">CredentialData</a> {
  USVString <a data-global-name="FederatedCredentialData<dictionary>/provider<dict-member>" data-type="USVString " href="#dom-federatedcredentialdata-provider">provider</a>;
  DOMString? <a data-global-name="FederatedCredentialData<dictionary>/protocol<dict-member>" data-type="DOMString? " href="#dom-federatedcredentialdata-protocol">protocol</a>;
};

[<a data-global-name="FederatedCredential<interface>/FederatedCredential(data)<constructor>" href="#dom-federatedcredential-federatedcredentialdata">Constructor</a>(<a data-link-type="idl-name" href="#dictdef-federatedcredentialdata">FederatedCredentialData</a> <a data-global-name="FederatedCredential<interface>/FederatedCredential(data)<method>/data<argument>" href="#dom-federatedcredential-federatedcredentialdata-data">data</a>), Exposed=Window]
interface <a data-global-name="" href="#federatedcredential">FederatedCredential</a> {
  readonly attribute USVString <a class="idl-code" data-global-name="FederatedCredential<interface>/provider<attribute>" data-link-type="attribute" data-readonly="" data-type="USVString " href="#dom-federatedcredential-provider">provider</a>;
  readonly attribute DOMString? <a class="idl-code" data-global-name="FederatedCredential<interface>/protocol<attribute>" data-link-type="attribute" data-readonly="" data-type="DOMString? " href="#dom-federatedcredential-protocol">protocol</a>;
};
<a data-link-type="idl-name" href="#federatedcredential">FederatedCredential</a> implements <a data-link-type="idl-name" href="#locallystoredcredential">LocallyStoredCredential</a>;

partial interface <a class="idl-code" data-link-type="interface" href="http://www.w3.org/TR/html5/webappapis.html#navigator">Navigator</a> {
  readonly attribute <a data-link-type="idl-name" href="#credentialcontainer">CredentialContainer</a> <a data-global-name="Navigator<interface>/credentials<attribute>" data-readonly="" data-type="CredentialContainer " href="#dom-navigator-credentials">credentials</a>;
};

interface <a data-global-name="" href="#credentialcontainer">CredentialContainer</a> {
  Promise&lt;<a data-link-type="idl-name" href="#credential">Credential</a>?> <a class="idl-code" data-global-name="CredentialContainer<interface>/get(request)<method>/get()<method>" data-link-type="method" href="#dom-credentialcontainer-getrequest">get</a>(optional <a data-link-type="idl-name" href="#dictdef-credentialrequest">CredentialRequest</a> <a data-global-name="CredentialContainer<interface>/get(request)<method>/request<argument>" href="#dom-credentialcontainer-getrequest-request">request</a>);
  Promise&lt;<a data-link-type="idl-name" href="#credential">Credential</a>> <a class="idl-code" data-global-name="CredentialContainer<interface>/store(credential)<method>/store()<method>" data-link-type="method" href="#dom-credentialcontainer-storecredential">store</a>(optional <a data-link-type="idl-name" href="#credential">Credential</a> <a data-global-name="CredentialContainer<interface>/store(credential)<method>/credential<argument>" href="#dom-credentialcontainer-storecredential-credential">credential</a>);
  Promise&lt;void> <a class="idl-code" data-global-name="CredentialContainer<interface>/requireUserMediation()<method>" data-link-type="method" href="#dom-credentialcontainer-requireusermediation">requireUserMediation</a>();
};

dictionary <a data-global-name="" href="#dictdef-federatedcredentialrequestoptions">FederatedCredentialRequestOptions</a> {
  sequence&lt;USVString> <a class="idl-code" data-global-name="FederatedCredentialRequestOptions<dictionary>/providers<dict-member>" data-link-type="dict-member" data-type="sequence<USVString> " href="#dom-federatedcredentialrequestoptions-providers">providers</a>;
  sequence&lt;DOMString> <a data-global-name="FederatedCredentialRequestOptions<dictionary>/protocols<dict-member>" data-type="sequence<DOMString> " href="#dom-federatedcredentialrequestoptions-protocols">protocols</a>;
};

typedef <a data-link-type="idl-name" href="#dictdef-federatedcredentialrequestoptions">FederatedCredentialRequestOptions</a> <a data-global-name="" href="#typedefdef-credentialrequestoptions">CredentialRequestOptions</a>;

dictionary <a data-global-name="" href="#dictdef-credentialrequest">CredentialRequest</a> {
  <a data-link-type="idl-name" href="#typedefdef-credentialrequestoptions">CredentialRequestOptions</a> <a class="idl-code" data-global-name="CredentialRequest<dictionary>/options<dict-member>" data-link-type="dict-member" data-type="CredentialRequestOptions " href="#dom-credentialrequest-options">options</a>;
  boolean <a class="idl-code" data-default="false" data-global-name="CredentialRequest<dictionary>/suppressUI<dict-member>" data-link-type="dict-member" data-type="boolean " href="#dom-credentialrequest-suppressui">suppressUI</a> = false;
  sequence&lt;DOMString> <a class="idl-code" data-global-name="CredentialRequest<dictionary>/types<dict-member>" data-link-type="dict-member" data-type="sequence<DOMString> " href="#dom-credentialrequest-types">types</a>;
};

</pre>
  <h2 class="no-num heading settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue">Define cloning algorithms. <a href="https://github.com/w3c/webappsec/issues/287">&lt;https://github.com/w3c/webappsec/issues/287></a><a href="#issue-43c3f08c"> ↵ </a></div>
   <div class="issue">Anne suggests that this might be better modeled
      as an <code>ImageBitmap</code> or <code>blob:</code>. We also need to
      figure out responsiveness. Perhaps <a data-link-type="biblio" href="#biblio-manifest">[MANIFEST]</a>'s format? <a href="https://github.com/w3c/webappsec/issues/247">&lt;https://github.com/w3c/webappsec/issues/247></a><a href="#issue-c874d302"> ↵ </a></div>
   <div class="issue">We need the ability to add additional
      information to the request (CSRF tokens, etc). <a href="https://github.com/w3c/webappsec/issues/241">&lt;https://github.com/w3c/webappsec/issues/241></a><a href="#issue-9c1ed270"> ↵ </a></div>
   <div class="issue">Probably not something for v1, but an
      interesting option would be to provide a hash function here that the user
      agent would apply to the password before sending it over the wire. <a href="https://github.com/w3c/webappsec/issues/288">&lt;https://github.com/w3c/webappsec/issues/288></a><a href="#issue-317aa5d1"> ↵ </a></div>
   <div class="issue">We should support explicit sign-up via
  <code class="idl"><a data-link-type="idl" href="#passwordcredential">PasswordCredential</a></code>s with generated passwords. Perhaps something similar to
  iOS8’s <code>SecCreateSharedWebCredentialPassword</code>. <a href="https://github.com/w3c/webappsec/issues/250">&lt;https://github.com/w3c/webappsec/issues/250></a><a href="#issue-69471d6f"> ↵ </a></div>
   <div class="issue">This is terribly hand-wavey. The intent is
      clear, but I need to do the work to walk through the list of DOMStrings
      and convert them to interfaces and etc. Busywork for later. <a href="https://github.com/w3c/webappsec/issues/289">&lt;https://github.com/w3c/webappsec/issues/289></a><a href="#issue-6005a2a4"> ↵ </a></div>
   <div class="issue">How do we deal with a future in which
  <code class="idl"><a data-link-type="idl" href="#locallystoredcredential">LocallyStoredCredential</a></code> isn’t the only type? For example, how could an
  author pull some "RemoteCredential" that required interaction with a
  third-party, but fall back to a <code class="idl"><a data-link-type="idl" href="#passwordcredential">PasswordCredential</a></code>? For the moment, we’re
  resolving this by rejecting the promise if the types listed in
  <code class="idl"><a data-link-type="idl" href="#dom-credentialrequest-types">types</a></code> aren’t all instances of the same type, but that
  seems like something we’d want to fix. <a href="https://github.com/w3c/webappsec/issues/256">&lt;https://github.com/w3c/webappsec/issues/256></a><a href="#issue-d98444f7"> ↵ </a></div>
   <div class="issue">Should we introduce a new Fetch context?
      <code>credential</code> or something? <a href="https://github.com/w3c/webappsec/issues/231">&lt;https://github.com/w3c/webappsec/issues/231></a><a href="#issue-b97befdf"> ↵ </a></div>
   <div class="issue">Add some thoughts here about when and how the API
  should be used, especially with regard to <code class="idl"><a data-link-type="idl" href="#dom-credentialrequest-suppressui">suppressUI</a></code>. <a href="https://github.com/w3c/webappsec/issues/290">&lt;https://github.com/w3c/webappsec/issues/290></a><a href="#issue-0bebb85f"> ↵ </a></div>
   <div class="issue">
    Groups like the
    <a href="http://www.w3.org/Payments/IG/">Web Payments IG</a>
    and the
    <a href="https://www.w3.org/community/credentials/">Credentials CG</a>
    have expressed interest in extending the API defined in this document in
    order to address use cases beyond those outlined in <a href="#use-cases">§1.1 Use Cases</a>. They’ve
    documented these use cases in detail in
    <a href="http://www.w3.org/TR/web-payments-use-cases/">Web Payments Use Cases 1.0</a>
    and
    <a href="http://opencreds.org/specs/source/use-cases/">Credentials CG Use Cases</a>,
    and anticipate extending the API in a separate document to solve a different
    set of problems than WebAppSec is currently chartered to deal with.  We
    should keep track of this work as it progresses and make appropriate
    references to any technical reports which may assist in understanding and
    implementing this report, as appropriate, when this document is ready to
    transition to Recommendation status.


    <p>It’s not yet clear whether the API proposed in this document allows these
    and other groups to elegantly address the problems they’re interested in
    solving. We may wish to adjust portions of the API before advancing this
    document to REC in order to ensure clean extensibility into these other
    areas.</p>
    
  <a href="#issue-9c0b1540"> ↵ </a>
   </div></div></body>
</html>
